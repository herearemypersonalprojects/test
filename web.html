<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Paris Discovery ‚Äì Web</title>

  <!-- GA d√πng chung -->
  <script src="ga-lozu.js"></script>

  <!-- C·∫•u h√¨nh cho Web Mode -->
  <script>
    window.addEventListener('load', function() {
      if (window.gtag && window.LOZU_GA_ID) {
        gtag('config', window.LOZU_GA_ID, {
          'page_title': 'Lozu ‚Äì Web Mode',
          'page_path': '/web'
        });

        // Event ph·ª• (t√πy ch·ªçn)
        gtag('event', 'view_mode', {
          'mode': 'web'
        });
      }
    });

    function onPoiClick(poi) {
  if (window.gtag && window.LOZU_GA_ID) {
    gtag('event', 'click_poi', {
      'poi_reference': poi.reference,
      'poi_name': poi.name,
      'score': poi.score || 0,
      'mode': 'web' // ho·∫∑c 'mobile'
    });
  }
}
function onChangeRadius(radius) {
  gtag('event', 'change_radius', {
    'radius_m': radius,
    'mode': 'mobile'
  });
}

function onChangePriority(priority) {
  gtag('event', 'change_priority', {
    'priority': priority, // nearest | famous
    'mode': 'mobile'
  });
}

  </script>

  <!-- favicon -->
  <link rel="icon" type="image/svg+xml" href="/icons/castle_favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/castle_logo_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/castle_logo_32.png">
  <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://unpkg.com/maplibre-gl@3.5.2/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@3.5.2/dist/maplibre-gl.js"></script>

  <style>
    /* === Base layout d√†nh cho m√†n h√¨nh l·ªõn (Web) === */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family:
        system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", Roboto, "Helvetica Neue", Arial,
        "Noto Sans", sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: #f3f7fb;
      color: #0d1b2a;
      font-size: 16px;
    }

    /* Header */
    header {
      background: #0d47a1;
      color: #e3f2fd;
      padding: 10px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
      border-bottom: 3px solid #64b5f6;
    }

    header .left {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-width: 60%;
    }

    header .title {
      font-weight: 700;
      font-size: 1.15rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #bbdefb;
    }

    header .subtitle {
      font-size: 0.9rem;
      opacity: 0.95;
      color: #e3f2fd;
    }

    header .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: nowrap;
    }

    /* Buttons */
    button {
      border: 1px solid #64b5f6;
      border-radius: 4px;
      padding: 9px 18px;
      font-size: 0.9rem;
      cursor: pointer;
      background: #1565c0;
      color: #e3f2fd;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.25);
      transition: all 0.2s ease;
      font-weight: 500;
    }

    button:hover {
      transform: translateY(-2px);
      background: #1e88e5;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      color: #e3f2fd;
    }

    button:disabled {
      opacity: 0.4;
      cursor: default;
      transform: none;
      box-shadow: none;
      background: #0b3c75;
      border-color: #54759b;
    }

    /* Inline TTS btn trong item (ch·ªâ hi·ªán khi active) */
    .tts-inline {
      margin-top: 6px;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 0.85rem;
      border: 1px solid #64b5f6;
      background: #1565c0;
      color: #e3f2fd;
      display: none;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .poi-item.active .tts-inline {
      display: inline-flex;
    }

    /* Language switch */
    .lang-switch {
      position: relative;
    }

    .lang-toggle {
      border-radius: 50%;
      width: 38px;
      height: 38px;
      padding: 0;
      background: #1e88e5;
      border: 2px solid #bbdefb;
      cursor: pointer;
      font-size: 1.3rem;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lang-menu {
      position: absolute;
      right: 0;
      top: 110%;
      background: #0d47a1;
      border-radius: 6px;
      padding: 6px;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.8);
      display: none;
      z-index: 20;
      min-width: 180px;
      border: 2px solid #64b5f6;
    }

    .lang-menu.open {
      display: block;
    }

    .lang-menu button {
      background: transparent;
      border-radius: 4px;
      border: none;
      padding: 7px 10px;
      color: #e3f2fd;
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      text-align: left;
      white-space: nowrap;
      box-shadow: none;
      transition: background 0.15s ease;
    }

    .lang-menu button:hover {
      background: #1565c0;
      color: #e3f2fd;
      transform: none;
      box-shadow: none;
    }

    /* Main layout Web: map + sidebar song song */
    main {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    #map {
      flex: 2;
      min-width: 0;
    }

    .sidebar {
      flex: 1;
      min-width: 280px;
      max-width: 420px;
      border-left: 2px solid #64b5f6;
      display: flex;
      flex-direction: column;
      background-color: #f5f9ff;
      color: #0d1b2a;
    }

    .sidebar-header {
      padding: 14px 16px;
      border-bottom: 2px solid #64b5f6;
      font-size: 1rem;
      background: #e3f2fd;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar-header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .sidebar-header-top span {
      font-weight: 700;
      color: #0d47a1;
      font-size: 1.05rem;
    }

    .filter-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .radius-row,
    .priority-row,
    .count-row {
      display: flex;
      gap: 4px;
      align-items: center;
      flex: 1 1 0;
      font-size: 0.9rem;
      color: #1b3551;
      font-weight: 500;
      min-width: 0;
    }

    .radius-select,
    .priority-select,
    .count-select {
      font-size: 0.9rem;
      padding: 6px 9px;
      border-radius: 4px;
      border: 1px solid #64b5f6;
      background: #ffffff;
      color: #0d1b2a;
      flex: 1;
      min-width: 0;
    }

    .poi-list {
      list-style: none;
      padding: 12px 14px;
      overflow-y: auto;
      flex: 1;
    }

    /* POI item */
    .poi-item {
      background: #ffffff;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 10px;
      border: 1px solid #d0d7e2;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.9rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* N·ªôi dung POI: ·∫£nh full chi·ªÅu ngang + text b√™n d∆∞·ªõi */
    .poi-content {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: stretch;
    }

    .poi-thumb {
      width: 100%;
      height: auto;
      max-height: 260px;
      border-radius: 6px;
      object-fit: cover;
      background: #cfd8dc;
      display: block;
    }

    .poi-main {
      flex: 1;
      min-width: 0;
    }

    .poi-top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 6px;
    }

    .poi-score {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e3f2fd;
      color: #0d47a1;
      font-weight: 600;
      white-space: nowrap;
    }

    .poi-item:hover {
      background: #f1f5ff;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.18);
      transform: translateY(-1px);
      border-color: #64b5f6;
    }

    .poi-item.active {
      border: 2px solid #1e88e5;
      background: #e3f2fd;
      box-shadow: 0 4px 12px rgba(30, 136, 229, 0.3);
    }

    .poi-title {
      font-weight: 700;
      margin-bottom: 4px;
      color: #0d47a1;
      font-size: 1rem;
    }

    .poi-address {
      color: #546e7a;
      margin-bottom: 4px;
      font-size: 0.85rem;
    }

    .poi-story {
      font-size: 0.85rem;
      color: #263238;
      margin-top: 4px;
      line-height: 1.5;
      max-height: 4.5em;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .poi-item.active .poi-story {
      max-height: 500px;
      overflow: visible;
    }

    .empty {
      font-size: 0.9rem;
      color: #607d8b;
      padding: 10px;
      text-align: center;
    }

    /* Popup */
    .maplibregl-popup-content {
      font-size: 0.9rem;
      border-radius: 6px;
      padding: 10px;
      border: 2px solid #64b5f6;
      background: #f5f9ff;
      color: #0d1b2a;
    }

    .popup-title {
      font-weight: 700;
      margin-bottom: 5px;
      color: #0d47a1;
    }

    .popup-address {
      font-size: 0.8rem;
      color: #546e7a;
      margin-bottom: 6px;
    }

    .popup-story {
      font-size: 0.8rem;
      color: #263238;
      max-width: 280px;
      margin-bottom: 8px;
    }

    .popup-tts-btn {
      margin-top: 6px;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 0.85rem;
      border: 1px solid #64b5f6;
      cursor: pointer;
      background: #1565c0;
      color: #e3f2fd;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
    }

    .popup-tts-btn:hover {
      background: #1e88e5;
    }

    /* Markers */
    .poi-marker {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #1565c0;
      border: 3px solid #bbdefb;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
      font-size: 16px;
      color: #e3f2fd;
      transition: transform 0.2s ease, box-shadow 0.2s ease, z-index 0.2s ease;
      cursor: pointer;
    }

    .poi-marker::after {
      content: "‚öúÔ∏è";
      font-size: 14px;
      line-height: 1;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    .poi-marker.highlighted {
      transform: scale(1.3);
      box-shadow: 0 0 20px rgba(66, 165, 245, 0.9);
      z-index: 10;
      background: #42a5f5;
      border-color: #e3f2fd;
    }

    .user-marker {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #1e8449;
      border: 3px solid #e3f2fd;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.7);
      font-size: 16px;
      z-index: 5;
    }

    .user-marker::after {
      content: "üë§";
      font-size: 14px;
      line-height: 1;
    }
  </style>
</head>
<body>
<header>
  <div class="left">
    <div id="app-title" class="title">PARIS DISCOVERY</div>
    <div id="app-subtitle" class="subtitle">
      Move around to discover heritage sites near you.
    </div>
  </div>
  <div class="controls">
    <div class="lang-switch">
      <button id="lang-toggle" class="lang-toggle" aria-label="Change language">üá¨üáß</button>
      <div id="lang-menu" class="lang-menu"></div>
    </div>
    <button id="locate-btn">üìç My location</button>
  </div>
</header>

<main>
  <div id="map"></div>

  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-header-top">
        <span id="nearby-title">Nearby places</span>
      </div>

      <div class="filter-row">
        <div class="radius-row">
          <label id="radius-label" for="radius">Radius:</label>
          <select id="radius" class="radius-select">
            <option value="0.5" selected>500 m</option>
            <option value="1">1 km</option>
            <option value="2">2 km</option>
            <option value="5">5 km</option>
            <option value="10">10 km</option>
          </select>
        </div>

        <div class="priority-row">
          <label id="priority-label" for="priority-filter">Priority:</label>
          <select id="priority-filter" class="priority-select">
            <option value="topscore">Most famous</option>
            <option value="nearest">Nearest</option>
          </select>
        </div>

        <div class="count-row">
          <label id="count-label" for="max-points">Places:</label>
          <select id="max-points" class="count-select">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="20">20</option>
          </select>
        </div>
      </div>
    </div>

    <ul id="poi-list" class="poi-list">
      <li id="empty-placeholder" class="empty">
        Move the map or click ‚Äúüìç My location‚Äù to see nearby heritage sites.
      </li>
    </ul>
  </aside>
</main>

<script>
  /* ==== JS gi·ªëng b·∫£n g·ªëc, ch·ªâ kh√°c h√†m isMobile() ==== */

  let map;
  let pois = [];
  let markers = [];
  let currentRadiusKm = 0.5;
  let currentMaxPoints = 10;
  let currentPriority = "topscore";

  let isProgrammaticMove = false;

  // LU√îN coi ƒë√¢y l√† b·∫£n Web
  function isMobile() {
    return false;
  }

  const languageConfigs = [
    { id: "en", key: "story_en",         flag: "üá¨üáß", label: "English",       ttsLang: "en-US" },
    { id: "fr", key: "story",            flag: "üá´üá∑", label: "Fran√ßais",      ttsLang: "fr-FR" },
    { id: "vi", key: "story_vn",         flag: "üáªüá≥", label: "Ti·∫øng Vi·ªát",    ttsLang: "vi-VN" },
    { id: "pt", key: "story_portuguese", flag: "üáµüáπ", label: "Portugu√™s",     ttsLang: "pt-PT" },
    { id: "ar", key: "story_arabic",     flag: "üá∏üá¶", label: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",       ttsLang: "ar-SA" },
    { id: "hi", key: "story_hindi",      flag: "üáÆüá≥", label: "‡§π‡§ø‡§®‡•ç‡§¶‡•Ä",        ttsLang: "hi-IN" },
    { id: "bn", key: "story_bengali",    flag: "üáßüá©", label: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ",         ttsLang: "bn-BD" },
    { id: "ko", key: "story_korean",     flag: "üá∞üá∑", label: "ÌïúÍµ≠Ïñ¥",        ttsLang: "ko-KR" },
    { id: "tr", key: "story_turkish",    flag: "üáπüá∑", label: "T√ºrk√ße",       ttsLang: "tr-TR" },
    { id: "sv", key: "story_swedish",    flag: "üá∏üá™", label: "Svenska",      ttsLang: "sv-SE" },
    { id: "de", key: "story_german",     flag: "üá©üá™", label: "Deutsch",       ttsLang: "de-DE" },
    { id: "zh", key: "story_chinese",    flag: "üá®üá≥", label: "‰∏≠Êñá",          ttsLang: "zh-CN" },
    { id: "ja", key: "story_japanese",   flag: "üáØüáµ", label: "Êó•Êú¨Ë™û",        ttsLang: "ja-JP" },
    { id: "ru", key: "story_russian",    flag: "üá∑üá∫", label: "–†—É—Å—Å–∫–∏–π",      ttsLang: "ru-RU" },
    { id: "it", key: "story_italian",    flag: "üáÆüáπ", label: "Italiano",      ttsLang: "it-IT" },
  ];

  function detectInitialLang() {
    var params = new URLSearchParams(window.location.search);
    var langParam = (params.get("lang") || "").toLowerCase(); // "vi", "fr", ...
    if (!langParam) {
      return languageConfigs[0]; // m·∫∑c ƒë·ªãnh English
    }
    var match = languageConfigs.find(function (cfg) {
      return cfg.id === langParam;
    });
    return match || languageConfigs[0];
  }

  let availableLanguages = languageConfigs.slice();
  let currentLangConfig = detectInitialLang(); // ƒë·ªçc t·ª´ ?lang=...

  let voices = [];
  let currentUtterance = null;

  const PARIS_CENTER = { lat: 48.8566, lon: 2.3522 };
  const NOTRE_DAME   = { lat: 48.852968, lon: 2.349902 };

  let userLocation = null;
  let userMarker = null;

  let lastNearbyPois = [];
  let highlightedPoiIdx = null;

  const locateBtn       = document.getElementById("locate-btn");
  const radiusSelect    = document.getElementById("radius");
  const poiListEl       = document.getElementById("poi-list");
  const nearbyTitleEl   = document.getElementById("nearby-title");
  const appTitleEl      = document.getElementById("app-title");
  const appSubtitleEl   = document.getElementById("app-subtitle");
  const radiusLabelEl   = document.getElementById("radius-label");
  const priorityLabelEl = document.getElementById("priority-label");
  const prioritySelect  = document.getElementById("priority-filter");
  const countLabelEl    = document.getElementById("count-label");
  const maxPointsSelect = document.getElementById("max-points");

  const langToggleBtn = document.getElementById("lang-toggle");
  const langMenu      = document.getElementById("lang-menu");

const i18n = {
  // üáªüá≥ Ti·∫øng Vi·ªát
  vi: {
    appTitle:       'Kh√°m Ph√° Paris',
    appSubtitle:    'ƒêi ƒë·∫øn ƒë√¢u, kh√°m ph√° di s·∫£n xung quanh ƒë√≥',
    locate:         'üìç V·ªã tr√≠ c·ªßa t√¥i',
    nearbyDefault:  'ƒêi·ªÉm g·∫ßn b·∫°n',
    radiusLabel:    'B√°n k√≠nh:',
    empty: r => `Kh√¥ng c√≥ di s·∫£n n√†o trong b√°n k√≠nh ${r} km quanh v·ªã tr√≠ hi·ªán t·∫°i c·ªßa b·∫£n ƒë·ªì.`,
    emptyInitial:   'Di chuy·ªÉn b·∫£n ƒë·ªì ho·∫∑c b·∫•m "üìç V·ªã tr√≠ c·ªßa t√¥i" ƒë·ªÉ xem c√°c di s·∫£n g·∫ßn b·∫°n.',
    ttsLabel:       'üîä Nghe k·ªÉ chuy·ªán',
    ttsNotSupported:'Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªçc vƒÉn b·∫£n (Speech Synthesis).',
    ttsNoText:      'Kh√¥ng c√≥ n·ªôi dung ƒë·ªÉ ƒë·ªçc.',
    priorityLabel:  '∆Øu ti√™n:',
    priorityNearest:'G·∫ßn nh·∫•t',
    priorityTopScore:'N·ªïi ti·∫øng nh·∫•t',
    countLabel:     'S·ªë ƒëi·ªÉm:',
  },

  // üá¨üáß English
  en: {
    appTitle:       'PARIS DISCOVERY',
    appSubtitle:    'Move around to discover heritage sites near you.',
    locate:         'üìç My location',
    nearbyDefault:  'Nearby places',
    radiusLabel:    'Radius:',
    empty: r => `No heritage site found within ${r} km of the current map center.`,
    emptyInitial:   'Move the map or click "üìç My location" to see nearby heritage sites.',
    ttsLabel:       'üîä Listen to story',
    ttsNotSupported:'Your browser does not support text-to-speech (Speech Synthesis).',
    ttsNoText:      'No story available to read.',
    priorityLabel:  'Priority:',
    priorityNearest:'Nearest',
    priorityTopScore:'Most famous',
    countLabel:     'Places:',
  },

  // üá´üá∑ Fran√ßais
  fr: {
    appTitle:       'Explorez Paris',
    appSubtitle:    'Explorez les sites patrimoniaux proches.',
    locate:         'üìç Ma position',
    nearbyDefault:  'Lieux √† proximit√©',
    radiusLabel:    'Rayon :',
    empty: r => `Aucun site patrimonial dans un rayon de ${r} km autour du centre de la carte.`,
    emptyInitial:   'D√©placez la carte ou cliquez sur "üìç Ma position" pour voir les sites patrimoniaux √† proximit√©.',
    ttsLabel:       'üîä √âcouter l‚Äôhistoire',
    ttsNotSupported:'Votre navigateur ne supporte pas la synth√®se vocale (Speech Synthesis).',
    ttsNoText:      'Aucun texte √† lire pour ce lieu.',
    priorityLabel:  'Priorit√© :',
    priorityNearest:'Les plus proches',
    priorityTopScore:'Les plus c√©l√®bres',
    countLabel:     'Nombre :',
  },

  // üáµüáπ Portugu√™s
  pt: {
    appTitle:       'Descubra Paris',
    appSubtitle:    'Mova-se para descobrir os locais hist√≥ricos perto de voc√™.',
    locate:         'üìç Minha localiza√ß√£o',
    nearbyDefault:  'Locais pr√≥ximos',
    radiusLabel:    'Raio:',
    empty: r => `Nenhum local hist√≥rico encontrado num raio de ${r} km do centro do mapa.`,
    emptyInitial:   'Mova o mapa ou clique em "üìç Minha localiza√ß√£o" para ver os locais hist√≥ricos pr√≥ximos.',
    ttsLabel:       'üîä Ouvir a hist√≥ria',
    ttsNotSupported:'O seu navegador n√£o suporta s√≠ntese de voz (Speech Synthesis).',
    ttsNoText:      'N√£o h√° texto dispon√≠vel para este local.',
    priorityLabel:  'Prioridade:',
    priorityNearest:'Mais pr√≥ximos',
    priorityTopScore:'Mais famosos',
    countLabel:     'Quantidade:',
  },

  // üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
  ar: {
    appTitle:       'ÿßŸÉÿ™ÿ¥ŸÅ ÿ®ÿßÿ±Ÿäÿ≥',
    appSubtitle:    'ÿ™ÿ≠ÿ±ŸëŸÉ ŸÑÿßŸÉÿ™ÿ¥ÿßŸÅ ÿßŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑÿ™ÿ±ÿßÿ´Ÿäÿ© ÿßŸÑŸÇÿ±Ÿäÿ®ÿ© ŸÖŸÜŸÉ.',
    locate:         'üìç ŸÖŸàŸÇÿπŸä',
    nearbyDefault:  'ÿ£ŸÖÿßŸÉŸÜ ŸÇÿ±Ÿäÿ®ÿ©',
    radiusLabel:    'ŸÜÿµŸÅ ÿßŸÑŸÇÿ∑ÿ±:',
    empty: r => `ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿßŸÇÿπ ÿ™ÿ±ÿßÿ´Ÿäÿ© ÿ∂ŸÖŸÜ ÿØÿßÿ¶ÿ±ÿ© ŸÜÿµŸÅ ŸÇÿ∑ÿ±Ÿáÿß ${r} ŸÉŸÖ ÿ≠ŸàŸÑ ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ≠ÿßŸÑŸä.`,
    emptyInitial:   'ÿ≠ÿ±ŸëŸÉ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿ£Ÿà ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "üìç ŸÖŸàŸÇÿπŸä" ŸÑÿ±ÿ§Ÿäÿ© ÿßŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑÿ™ÿ±ÿßÿ´Ÿäÿ© ÿßŸÑŸÇÿ±Ÿäÿ®ÿ©.',
    ttsLabel:       'üîä ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ÿ•ŸÑŸâ ÿßŸÑŸÇÿµÿ©',
    ttsNotSupported:'ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÑÿß ŸäÿØÿπŸÖ ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜÿµ ÿ•ŸÑŸâ ŸÉŸÑÿßŸÖ (Speech Synthesis).',
    ttsNoText:      'ŸÑÿß ŸäŸàÿ¨ÿØ ŸÜÿµ ŸÑŸÑŸÇÿ±ÿßÿ°ÿ© ŸÑŸáÿ∞ÿß ÿßŸÑŸÖŸàŸÇÿπ.',
    priorityLabel:  'ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©:',
    priorityNearest:'ÿßŸÑÿ£ŸÇÿ±ÿ®',
    priorityTopScore:'ÿßŸÑÿ£ÿ¥Ÿáÿ±',
    countLabel:     'ÿßŸÑÿπÿØÿØ:',
  },

  // üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä
  hi: {
    appTitle:       '‡§™‡•á‡§∞‡§ø‡§∏ ‡§ï‡•Ä ‡§ñ‡•ã‡§ú',
    appSubtitle:    '‡§Ö‡§™‡§®‡•á ‡§Ü‡§∏‡§™‡§æ‡§∏ ‡§ï‡•á ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§∏‡•ç‡§•‡§≤‡•ã‡§Ç ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ò‡•Ç‡§Æ‡•á‡§Ç‡•§',
    locate:         'üìç ‡§Æ‡•á‡§∞‡§æ ‡§∏‡•ç‡§•‡§æ‡§®',
    nearbyDefault:  '‡§™‡§æ‡§∏ ‡§ï‡•á ‡§∏‡•ç‡§•‡§æ‡§®',
    radiusLabel:    '‡§§‡•ç‡§∞‡§ø‡§ú‡•ç‡§Ø‡§æ:',
    empty: r => `‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞ ‡§ï‡•á ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§∏‡•á ${r} ‡§ï‡§ø‡§Æ‡•Ä ‡§ï‡•Ä ‡§§‡•ç‡§∞‡§ø‡§ú‡•ç‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§∏‡•ç‡§•‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§`,
    emptyInitial:   '‡§®‡§ï‡•ç‡§∂‡•á ‡§ï‡•ã ‡§ò‡•Å‡§Æ‡§æ‡§è‡§Å ‡§Ø‡§æ "üìç ‡§Æ‡•á‡§∞‡§æ ‡§∏‡•ç‡§•‡§æ‡§®" ‡§¶‡§¨‡§æ‡§è‡§Å ‡§§‡§æ‡§ï‡§ø ‡§™‡§æ‡§∏ ‡§ï‡•á ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§∏‡•ç‡§•‡§≤ ‡§¶‡§ø‡§ñ‡•á‡§Ç‡•§',
    ttsLabel:       'üîä ‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡•Å‡§®‡•á‡§Ç',
    ttsNotSupported:'‡§Ü‡§™‡§ï‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü-‡§ü‡•Ç-‡§∏‡•ç‡§™‡•Ä‡§ö (Speech Synthesis) ‡§ï‡•ã ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§',
    ttsNoText:      '‡§á‡§∏ ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§™‡§æ‡§† ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§',
    priorityLabel:  '‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ:',
    priorityNearest:'‡§∏‡§¨‡§∏‡•á ‡§®‡§ú‡§º‡§¶‡•Ä‡§ï‡•Ä',
    priorityTopScore:'‡§∏‡§¨‡§∏‡•á ‡§™‡•ç‡§∞‡§∏‡§ø‡§¶‡•ç‡§ß',
    countLabel:     '‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ:',
  },

  // üáßüá© ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ
  bn: {
    appTitle:       '‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶∏ ‡¶ò‡ßÅ‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®',
    appSubtitle:    '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶∂‡¶™‡¶æ‡¶∂‡ßá‡¶∞ ‡¶ê‡¶§‡¶ø‡¶π‡ßç‡¶Ø‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡ßá‡¶§‡ßá ‡¶®‡¶°‡¶º‡¶æ‡¶ö‡¶°‡¶º‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
    locate:         'üìç ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®',
    nearbyDefault:  '‡¶ï‡¶æ‡¶õ‡¶æ‡¶ï‡¶æ‡¶õ‡¶ø ‡¶∏‡ßç‡¶•‡¶æ‡¶®',
    radiusLabel:    '‡¶¨‡ßç‡¶Ø‡¶æ‡¶∏‡¶æ‡¶∞‡ßç‡¶ß:',
    empty: r => `‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ${r} ‡¶ï‡¶ø‡¶Æ‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶∏‡¶æ‡¶∞‡ßç‡¶ß‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶ê‡¶§‡¶ø‡¶π‡ßç‡¶Ø‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§`,
    emptyInitial:   '‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞ ‡¶∏‡¶∞‡¶æ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ "üìç ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®" ‡¶ö‡¶æ‡¶™‡ßÅ‡¶® ‡¶ï‡¶æ‡¶õ‡¶æ‡¶ï‡¶æ‡¶õ‡¶ø ‡¶ê‡¶§‡¶ø‡¶π‡ßç‡¶Ø‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá‡•§',
    ttsLabel:       'üîä ‡¶ó‡¶≤‡ßç‡¶™ ‡¶∂‡ßÅ‡¶®‡ßÅ‡¶®',
    ttsNotSupported:'‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü-‡¶ü‡ßÅ-‡¶∏‡ßç‡¶™‡¶ø‡¶ö (Speech Synthesis) ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶® ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§',
    ttsNoText:      '‡¶è‡¶á ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶®‡ßá‡¶á‡•§',
    priorityLabel:  '‡¶Ö‡¶ó‡ßç‡¶∞‡¶æ‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞:',
    priorityNearest:'‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶®‡¶ø‡¶ï‡¶ü‡¶¨‡¶∞‡ßç‡¶§‡ßÄ',
    priorityTopScore:'‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡¶ø‡¶ñ‡ßç‡¶Ø‡¶æ‡¶§',
    countLabel:     '‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ:',
  },

  // üá∞üá∑ ÌïúÍµ≠Ïñ¥
  ko: {
    appTitle:       'ÌååÎ¶¨Î•º Î∞úÍ≤¨ÌïòÏÑ∏Ïöî',
    appSubtitle:    'Ï£ºÎ≥ÄÏùò Ïú†ÏÇ∞ Ïû•ÏÜåÎ•º Î∞úÍ≤¨ÌïòÍ∏∞ ÏúÑÌï¥ Ïù¥ÎèôÌï¥ Î≥¥ÏÑ∏Ïöî.',
    locate:         'üìç ÎÇ¥ ÏúÑÏπò',
    nearbyDefault:  'Ï£ºÎ≥Ä Ïû•ÏÜå',
    radiusLabel:    'Î∞òÍ≤Ω:',
    empty: r => `ÌòÑÏû¨ ÏßÄÎèÑ Ï§ëÏã¨ÏóêÏÑú Î∞òÍ≤Ω ${r}km ÏïàÏóê Ïú†ÏÇ∞ Ïû•ÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§.`,
    emptyInitial:   'ÏßÄÎèÑÎ•º ÏõÄÏßÅÏù¥Í±∞ÎÇò "üìç ÎÇ¥ ÏúÑÏπò"Î•º ÎàåÎü¨ Ï£ºÎ≥Ä Ïú†ÏÇ∞ Ïû•ÏÜåÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.',
    ttsLabel:       'üîä Ïù¥ÏïºÍ∏∞ Îì£Í∏∞',
    ttsNotSupported:'Î∏åÎùºÏö∞Ï†ÄÍ∞Ä ÌÖçÏä§Ìä∏ ÏùåÏÑ± Î≥ÄÌôò(Speech Synthesis)ÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.',
    ttsNoText:      'Ïù¥ Ïû•ÏÜåÏóê ÎåÄÌï¥ ÏùΩÏùÑ Ïàò ÏûàÎäî ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.',
    priorityLabel:  'Ïö∞ÏÑ†ÏàúÏúÑ:',
    priorityNearest:'Í∞ÄÏû• Í∞ÄÍπåÏö¥',
    priorityTopScore:'Í∞ÄÏû• Ïú†Î™ÖÌïú',
    countLabel:     'Í∞úÏàò:',
  },

  // üáπüá∑ T√ºrk√ße
  tr: {
    appTitle:       'Paris‚Äôi ke≈üfet',
    appSubtitle:    'Yakƒ±nƒ±nƒ±zdaki k√ºlt√ºrel miras alanlarƒ±nƒ± ke≈üfetmek i√ßin hareket edin.',
    locate:         'üìç Konumum',
    nearbyDefault:  'Yakƒ±n yerler',
    radiusLabel:    'Yarƒ±√ßap:',
    empty: r => `Haritanƒ±n mevcut merkezi etrafƒ±nda ${r} km yarƒ±√ßap i√ßinde herhangi bir miras alanƒ± bulunamadƒ±.`,
    emptyInitial:   'Haritayƒ± hareket ettirin veya "üìç Konumum" d√ºƒümesine tƒ±klayƒ±n ve yakƒ±n miras alanlarƒ±nƒ± g√∂r√ºn.',
    ttsLabel:       'üîä Hik√¢yeyi dinle',
    ttsNotSupported:'Tarayƒ±cƒ±nƒ±z metin okuma (Speech Synthesis) √∂zelliƒüini desteklemiyor.',
    ttsNoText:      'Bu yer i√ßin okunacak bir metin yok.',
    priorityLabel:  '√ñncelik:',
    priorityNearest:'En yakƒ±n',
    priorityTopScore:'En √ºnl√º',
    countLabel:     'Sayƒ±:',
  },

  // üá∏üá™ Svenska
  sv: {
    appTitle:       'Uppt√§ck Paris',
    appSubtitle:    'R√∂r dig f√∂r att uppt√§cka kulturarvsplatser n√§ra dig.',
    locate:         'üìç Min position',
    nearbyDefault:  'Platser i n√§rheten',
    radiusLabel:    'Radie:',
    empty: r => `Inga kulturarvsplatser hittades inom ${r} km fr√•n kartans nuvarande centrum.`,
    emptyInitial:   'Flytta kartan eller klicka p√• "üìç Min position" f√∂r att se kulturarvsplatser i n√§rheten.',
    ttsLabel:       'üîä Lyssna p√• ber√§ttelsen',
    ttsNotSupported:'Din webbl√§sare st√∂der inte text-till-tal (Speech Synthesis).',
    ttsNoText:      'Det finns ingen text att l√§sa upp f√∂r den h√§r platsen.',
    priorityLabel:  'Prioritet:',
    priorityNearest:'N√§rmast',
    priorityTopScore:'Mest k√§nda',
    countLabel:     'Antal:',
  },

  // üá©üá™ Deutsch
  de: {
    appTitle:       'Paris entdecken',
    appSubtitle:    'Bewegen Sie sich, um Sehensw√ºrdigkeiten in Ihrer N√§he zu entdecken.',
    locate:         'üìç Mein Standort',
    nearbyDefault:  'Orte in der N√§he',
    radiusLabel:    'Radius:',
    empty: r => `Keine Sehensw√ºrdigkeit im Umkreis von ${r} km um die aktuelle Kartenmitte gefunden.`,
    emptyInitial:   'Verschieben Sie die Karte oder klicken Sie auf "üìç Mein Standort", um nahegelegene Sehensw√ºrdigkeiten zu sehen.',
    ttsLabel:       'üîä Geschichte anh√∂ren',
    ttsNotSupported:'Ihr Browser unterst√ºtzt keine Sprachausgabe (Speech Synthesis).',
    ttsNoText:      'F√ºr diesen Ort gibt es keinen Text zum Vorlesen.',
    priorityLabel:  'Priorit√§t:',
    priorityNearest:'N√§chstgelegen',
    priorityTopScore:'Am bekanntesten',
    countLabel:     'Anzahl:',
  },

  // üá®üá≥ ‰∏≠Êñá
  zh: {
    appTitle:       'Êé¢Á¥¢Â∑¥Èªé',
    appSubtitle:    'ÁßªÂä®Âú∞ÂõæÔºåÂèëÁé∞ÊÇ®ÈôÑËøëÁöÑÊñáÂåñÈÅó‰∫ßÊôØÁÇπ„ÄÇ',
    locate:         'üìç ÊàëÁöÑ‰ΩçÁΩÆ',
    nearbyDefault:  'ÈôÑËøëÂú∞ÁÇπ',
    radiusLabel:    'ÂçäÂæÑÔºö',
    empty: r => `Âú®ÂΩìÂâçÂú∞Âõæ‰∏≠ÂøÉ${r}ÂÖ¨ÈáåËåÉÂõ¥ÂÜÖÊú™ÊâæÂà∞‰ªª‰ΩïÊñáÂåñÈÅó‰∫ßÂú∞ÁÇπ„ÄÇ`,
    emptyInitial:   'ÁßªÂä®Âú∞ÂõæÊàñÁÇπÂáª‚Äúüìç ÊàëÁöÑ‰ΩçÁΩÆ‚ÄùÊù•Êü•ÁúãÈôÑËøëÁöÑÊñáÂåñÈÅó‰∫ßÂú∞ÁÇπ„ÄÇ',
    ttsLabel:       'üîä Âê¨ÊïÖ‰∫ã',
    ttsNotSupported:'ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅÊñáÊú¨ÊúóËØªÔºàSpeech SynthesisÔºâ„ÄÇ',
    ttsNoText:      'Ê≠§Âú∞ÁÇπÊ≤°ÊúâÂèØÊúóËØªÁöÑÂÜÖÂÆπ„ÄÇ',
    priorityLabel:  '‰ºòÂÖàÁ∫ßÔºö',
    priorityNearest:'ÊúÄËøë',
    priorityTopScore:'ÊúÄËëóÂêç',
    countLabel:     'Êï∞ÈáèÔºö',
  },

  // üáØüáµ Êó•Êú¨Ë™û
  ja: {
    appTitle:       '„Éë„É™„ÇíÁô∫Ë¶ã',
    appSubtitle:    'Âë®Ëæ∫„ÅÆÊñáÂåñÈÅ∫Áî£„ÇíË¶ã„Å§„Åë„Çã„Åü„ÇÅ„Å´ÁßªÂãï„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ',
    locate:         'üìç ÁèæÂú®Âú∞',
    nearbyDefault:  'Ëøë„Åè„ÅÆÂ†¥ÊâÄ',
    radiusLabel:    'ÂçäÂæÑ:',
    empty: r => `ÁèæÂú®„ÅÆÂú∞Âõ≥‰∏≠ÂøÉ„Åã„ÇâÂçäÂæÑ${r}km‰ª•ÂÜÖ„Å´ÊñáÂåñÈÅ∫Áî£„ÅØË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ`,
    emptyInitial:   'Âú∞Âõ≥„ÇíÂãï„Åã„Åô„Åã„Äåüìç ÁèæÂú®Âú∞„Äç„Çí„Çø„ÉÉ„Éó„Åó„Å¶„ÄÅËøë„Åè„ÅÆÊñáÂåñÈÅ∫Áî£„ÇíË°®Á§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
    ttsLabel:       'üîä „Çπ„Éà„Éº„É™„Éº„ÇíËÅû„Åè',
    ttsNotSupported:'„ÅîÂà©Áî®„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ„ÉÜ„Ç≠„Çπ„ÉàË™≠„Åø‰∏ä„ÅíÔºàSpeech SynthesisÔºâ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ',
    ttsNoText:      '„Åì„ÅÆÂ†¥ÊâÄ„Å´„ÅØË™≠„Åø‰∏ä„Åí„Çã„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ',
    priorityLabel:  'ÂÑ™ÂÖàÈ†Ü‰Ωç:',
    priorityNearest:'ÊúÄ„ÇÇËøë„ÅÑ',
    priorityTopScore:'ÊúÄ„ÇÇÊúâÂêç',
    countLabel:     '‰ª∂Êï∞:',
  },

  // üá∑üá∫ –†—É—Å—Å–∫–∏–π
  ru: {
    appTitle:       '–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –ü–∞—Ä–∏–∂',
    appSubtitle:    '–ü–µ—Ä–µ–¥–≤–∏–≥–∞–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –Ω–∞—Ö–æ–¥–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è —Ä—è–¥–æ–º —Å –≤–∞–º–∏.',
    locate:         'üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',
    nearbyDefault:  '–ú–µ—Å—Ç–∞ —Ä—è–¥–æ–º',
    radiusLabel:    '–†–∞–¥–∏—É—Å:',
    empty: r => `–í —Ä–∞–¥–∏—É—Å–µ ${r} –∫–º –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞ –∫–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤ –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è.`,
    emptyInitial:   '–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –∫–∞—Ä—Ç—É –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ", —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –±–ª–∏–∂–∞–π—à–∏–µ –æ–±—ä–µ–∫—Ç—ã –Ω–∞—Å–ª–µ–¥–∏—è.',
    ttsLabel:       'üîä –ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é',
    ttsNotSupported:'–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ (Speech Synthesis).',
    ttsNoText:      '–î–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è.',
    priorityLabel:  '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:',
    priorityNearest:'–ë–ª–∏–∂–∞–π—à–∏–µ',
    priorityTopScore:'–°–∞–º—ã–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ',
    countLabel:     '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:',
  },

  // üáÆüáπ Italiano
  it: {
    appTitle:       'Scopri Parigi',
    appSubtitle:    'Muoviti per scoprire i siti storici vicino a te.',
    locate:         'üìç La mia posizione',
    nearbyDefault:  'Luoghi vicini',
    radiusLabel:    'Raggio:',
    empty: r => `Nessun sito storico trovato entro ${r} km dal centro attuale della mappa.`,
    emptyInitial:   'Sposta la mappa o fai clic su "üìç La mia posizione" per vedere i siti storici nelle vicinanze.',
    ttsLabel:       'üîä Ascolta la storia',
    ttsNotSupported:'Il tuo browser non supporta la sintesi vocale (Speech Synthesis).',
    ttsNoText:      'Nessun testo da leggere per questo luogo.',
    priorityLabel:  'Priorit√†:',
    priorityNearest:'Pi√π vicini',
    priorityTopScore:'Pi√π famosi',
    countLabel:     'Numero:',
  },
};

  function closeAllPopups(exceptIdx = null) {
    if (!markers || !markers.length) return;
    markers.forEach(m => {
      if (!m || typeof m.getPopup !== "function") return;
      const p = m.getPopup();
      if (p && p.isOpen() && m._poiIdx !== exceptIdx) {
        p.remove();
      }
    });
  }

function getUiLangId() {
  if (!currentLangConfig) return 'en';
  const id = currentLangConfig.id;
  // n·∫øu c√≥ c·∫•u h√¨nh i18n cho id th√¨ d√πng, kh√¥ng th√¨ fallback English
  return i18n[id] ? id : 'en';
}


  function getName(poi) {
    const lang = getUiLangId();
    if (lang === "vi") {
      return poi.name_vn || poi.name_en || poi.name || "Kh√¥ng t√™n";
    } else if (lang === "en") {
      return poi.name_en || poi.name || poi.name_vn || "Unnamed";
    } else {
      return poi.name || poi.name_en || poi.name_vn || "Sans nom";
    }
  }

  function getAddress(poi) {
    const lang = getUiLangId();
    if (lang === "vi") {
      return poi.address_vn || poi.address_en || poi.address || "";
    } else if (lang === "en") {
      return poi.address_en || poi.address || poi.address_vn || "";
    } else {
      return poi.address || poi.address_en || poi.address_vn || "";
    }
  }

  function getStory(poi) {
    // ∆Øu ti√™n d√πng field t∆∞∆°ng ·ª©ng v·ªõi currentLangConfig.key
    if (currentLangConfig && poi[currentLangConfig.key]) {
      return poi[currentLangConfig.key];
    }

    // Fallback theo th·ª© t·ª± ∆∞u ti√™n: ti·∫øng Anh -> ti·∫øng Ph√°p g·ªëc ->  ti·∫øng Vi·ªát
    if (poi.story_en) return poi.story_en;
    if (poi.story)    return poi.story;
    if (poi.story_vn) return poi.story_vn;

    return "";
  }


  function loadVoices() {
    voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
  }
  if ("speechSynthesis" in window) {
    window.speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();
  }

  function getVoiceForLangCode(langCode) {
    if (!voices || !voices.length) return null;
    const prefix = langCode.split("-")[0].toLowerCase();
    let v = voices.find(v => v.lang && v.lang.toLowerCase().startsWith(prefix));
    if (!v) v = voices[0];
    return v;
  }

  function playPoiStory(index) {
    const uiLang = getUiLangId();
    const t = i18n[uiLang];

    if (!("speechSynthesis" in window)) {
      alert(t.ttsNotSupported);
      return;
    }

    if (window.speechSynthesis.speaking || window.speechSynthesis.pending) {
      window.speechSynthesis.cancel();
      currentUtterance = null;
      return;
    }

    const poi = pois[index];
    if (!poi) return;
    const text = getStory(poi);
    if (!text) {
      alert(t.ttsNoText);
      return;
    }

    const langCode = currentLangConfig?.ttsLang || "en-US";
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = langCode;
    const v = getVoiceForLangCode(langCode);
    if (v) utter.voice = v;

    currentUtterance = utter;
    window.speechSynthesis.speak(utter);
  }

  window.playPoiStory = playPoiStory;

  function distanceKm(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a =
      Math.sin(dLat / 2) * Math.sin(dLat / 2) +
      Math.cos(lat1 * Math.PI / 180) *
      Math.cos(lat2 * Math.PI / 180) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  function highlightMarkerForPoiIdx(idx) {
    highlightedPoiIdx = idx;
    markers.forEach(m => {
      if (!m._el) return;
      if (m._poiIdx === idx) {
        m._el.classList.add("highlighted");
      } else {
        m._el.classList.remove("highlighted");
      }
    });
  }

  function highlightPoiListItem(idx) {
    const listItems = poiListEl.querySelectorAll('.poi-item');
    listItems.forEach(li => {
      const poiIdx = parseInt(li.getAttribute('data-poi-idx'));
      if (poiIdx === idx) {
        li.classList.add('active');
        li.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      } else {
        li.classList.remove('active');
      }
    });
  }

  function createMarker(poi) {
    const el = document.createElement("div");
    el.className = "poi-marker";

    const marker = new maplibregl.Marker({ element: el, anchor: 'center' })
      .setLngLat([poi.lon, poi.lat])
      .addTo(map);

    marker._el = el;
    marker._poiIdx = poi._idx;

    const popup = new maplibregl.Popup({ offset: 18, closeButton: false, closeOnClick: false });

    function updatePopupContent() {
      const title = getName(poi);
      const addr = getAddress(poi);
      const story = getStory(poi);
      const uiLang = getUiLangId();
      const t = i18n[uiLang];

      const html = `
        <div>
          <div class="popup-title">${title}</div>
          <div class="popup-address">${addr}</div>
          <div class="popup-story">${story.slice(0, 260)}...</div>
          <button class="popup-tts-btn" onclick="playPoiStory(${poi._idx})">
            ${t.ttsLabel}
          </button>
        </div>
      `;
      popup.setHTML(html);
    }

    updatePopupContent();

    el.addEventListener("click", (e) => {
      e.stopPropagation();
      highlightMarkerForPoiIdx(poi._idx);
      highlightPoiListItem(poi._idx);
      updatePopupContent();

      // Web: lu√¥n hi·ªÉn th·ªã popup
      closeAllPopups(poi._idx);

      if (!marker._popup || !marker._popup.isOpen()) {
        marker.setPopup(popup);
        popup.setLngLat([poi.lon, poi.lat]).addTo(map);
      }
    });

    marker.setPopup(popup);
    marker._updatePopupContent = updatePopupContent;

    return marker;
  }

  function clearMarkers() {
    markers.forEach(m => m.remove());
    markers = [];
  }

  function updateUserMarker() {
    if (!map || !userLocation) return;
    if (userMarker) {
      userMarker.setLngLat([userLocation.lon, userLocation.lat]);
    } else {
      const el = document.createElement("div");
      el.className = "user-marker";
      userMarker = new maplibregl.Marker({ element: el, anchor: 'center' })
        .setLngLat([userLocation.lon, userLocation.lat])
        .addTo(map);
    }
  }

  function updateNearbyList() {
    if (!map || !pois.length) return;
    const center = map.getCenter();
    const centerLat = center.lat;
    const centerLon = center.lng;
    const uiLang = getUiLangId();
    const t = i18n[uiLang];

    const valid = pois.filter(p => p.lat && p.lon);

    let within = valid
      .map(p => ({
        ...p,
        dist: distanceKm(centerLat, centerLon, p.lat, p.lon),
      }))
      .filter(p => p.dist <= currentRadiusKm);

    let selected = [];

    if (within.length === 0) {
      selected = [];
    } else if (currentPriority === "nearest") {
      selected = within
        .sort((a, b) => a.dist - b.dist)
        .slice(0, currentMaxPoints);
    } else {
      selected = within
        .sort((a, b) => {
          const sa = typeof a.score === "number" ? a.score : -Infinity;
          const sb = typeof b.score === "number" ? b.score : -Infinity;
          return sb - sa;
        });
      if (selected.length > currentMaxPoints) {
        selected = selected.slice(0, currentMaxPoints);
      }
    }

    lastNearbyPois = selected;

    clearMarkers();
    selected.forEach(p => {
      const m = createMarker(p);
      markers.push(m);
    });

    highlightMarkerForPoiIdx(highlightedPoiIdx);
    updateUserMarker();

    poiListEl.innerHTML = "";

    if (!selected.length) {
      const li = document.createElement("li");
      li.className = "empty";
      li.textContent = t.empty(currentRadiusKm);
      poiListEl.appendChild(li);
      nearbyTitleEl.textContent = t.nearbyDefault;
      return;
    }

    nearbyTitleEl.textContent = t.nearbyDefault;

    selected.forEach(poi => {
      const li = document.createElement("li");
      li.className = "poi-item";
      li.setAttribute('data-poi-idx', poi._idx);

      const title = getName(poi);
      const addr = getAddress(poi);
      const story = getStory(poi);

      let scoreText = "";
      if (typeof poi.score === "number") {
        const rounded = Math.round(poi.score * 100) / 10;
        scoreText = rounded.toFixed(1);
      }

      const imgSrc = poi.reference
        ? `./images/${poi.reference.toLowerCase()}.jpg`
        : "";

      li.innerHTML = `
        <div class="poi-content">
          <img
            class="poi-thumb"
            src="${imgSrc}"
            alt="${title}"
            onerror="this.style.display='none';"
          />
          <div class="poi-main">
            <div class="poi-top-row">
              <div>
                <div class="poi-title">${title}</div>
                <div class="poi-address">${addr}</div>
              </div>
              ${scoreText
                ? `<div class="poi-score">‚≠ê ${scoreText}/10</div>`
                : ""
              }
            </div>
            <div class="poi-story">${story}</div>
            <button type="button"
              class="tts-inline"
              onclick="playPoiStory(${poi._idx})">
              ${t.ttsLabel}
            </button>
          </div>
        </div>
      `;

      if (poi._idx === highlightedPoiIdx) {
        li.classList.add('active');
      }

      li.addEventListener("click", () => {
        highlightPoiListItem(poi._idx);
        highlightMarkerForPoiIdx(poi._idx);

        const marker = markers.find(m => m._poiIdx === poi._idx);
        if (marker) {
          closeAllPopups(poi._idx);
          const popup = marker.getPopup();
          if (popup && !popup.isOpen()) {
            popup.setLngLat([poi.lon, poi.lat]).addTo(map);
          }
        }

        isProgrammaticMove = true;
        map.flyTo({
          center: [poi.lon, poi.lat],
          zoom: 15,
          essential: true
        });
      });

      poiListEl.appendChild(li);
    });
  }

  function fitToNearbyPois() {
    if (!map || !lastNearbyPois || !lastNearbyPois.length) return;

    if (lastNearbyPois.length === 1) {
      const p = lastNearbyPois[0];
      map.flyTo({
        center: [p.lon, p.lat],
        zoom: 16,
        essential: true
      });
      return;
    }

    const bounds = new maplibregl.LngLatBounds();
    lastNearbyPois.forEach(p => bounds.extend([p.lon, p.lat]));
    if (userLocation) bounds.extend([userLocation.lon, userLocation.lat]);

    map.fitBounds(bounds, { padding: 40 });
  }

  function initMap() {
    const osmStyle = {
      version: 8,
      sources: {
        "osm-tiles": {
          type: "raster",
          tiles: ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
          tileSize: 256,
          attribution: ""
        }
      },
      layers: [
        {
          id: "osm-tiles",
          type: "raster",
          source: "osm-tiles",
          minzoom: 0,
          maxzoom: 19
        }
      ]
    };

    map = new maplibregl.Map({
      container: "map",
      style: osmStyle,
      center: [PARIS_CENTER.lon, PARIS_CENTER.lat],
      zoom: 5
    });

    map.on("load", () => {
      resetView();
    });

    map.on("moveend", () => {
      if (isProgrammaticMove) {
        isProgrammaticMove = false;
        return;
      }
      updateNearbyList();
    });

    map.on("click", (e) => {
      if (!e.originalEvent.target.closest('.maplibregl-marker')) {
        highlightMarkerForPoiIdx(null);
        highlightPoiListItem(null);
        highlightedPoiIdx = null;
      }
    });
  }

  async function loadPois() {
    try {
      const res = await fetch("paris_story_multilanguage.json");
      if (!res.ok) {
        throw new Error("Kh√¥ng load ƒë∆∞·ª£c paris_story_multilanguage.json: " + res.status);
      }
      const raw = await res.json();
      pois = raw.map((p, idx) => ({ ...p, _idx: idx }));
    } catch (err) {
      console.error(err);
      alert("Kh√¥ng load ƒë∆∞·ª£c d·ªØ li·ªáu POI (paris_story_multilanguage.json). H√£y ki·ªÉm tra l·∫°i file v√† ƒë∆∞·ªùng d·∫´n.");
    }
  }

  function renderLanguageMenu() {
    if (!availableLanguages.length) return;
    langMenu.innerHTML = "";

    availableLanguages.forEach(cfg => {
      const btn = document.createElement("button");
      btn.setAttribute("data-lang-id", cfg.id);
      btn.innerHTML = `<span>${cfg.flag}</span><span>${cfg.label}</span>`;
      langMenu.appendChild(btn);
    });

    langToggleBtn.textContent = currentLangConfig.flag || "üåê";
  }

  function applyLanguage() {
    const uiLang = getUiLangId();
    const t = i18n[uiLang];

    appTitleEl.textContent    = t.appTitle;
    appSubtitleEl.textContent = t.appSubtitle;
    locateBtn.textContent     = t.locate;
    radiusLabelEl.textContent = t.radiusLabel;
    priorityLabelEl.textContent = t.priorityLabel;
    countLabelEl.textContent  = t.countLabel;
    nearbyTitleEl.textContent = t.nearbyDefault;

    const nearestOpt = prioritySelect.querySelector('option[value="nearest"]');
    const topOpt = prioritySelect.querySelector('option[value="topscore"]');
    if (nearestOpt) nearestOpt.textContent = t.priorityNearest;
    if (topOpt) topOpt.textContent = t.priorityTopScore;

    if (currentLangConfig) {
      langToggleBtn.textContent = currentLangConfig.flag || "üåê";
    }

    markers.forEach(m => m._updatePopupContent());
    updateNearbyList();
  }

  function resetView() {
    let center;

    if (userLocation) {
      const d = distanceKm(
        userLocation.lat,
        userLocation.lon,
        PARIS_CENTER.lat,
        PARIS_CENTER.lon
      );
      if (d <= 8) {
        center = [userLocation.lon, userLocation.lat];
      }
    }

    if (!center) {
      center = [NOTRE_DAME.lon, NOTRE_DAME.lat];
    }

    map.jumpTo({
      center,
      zoom: 14
    });

    highlightMarkerForPoiIdx(null);
    highlightPoiListItem(null);
    highlightedPoiIdx = null;

    updateNearbyList();
    fitToNearbyPois();
  }

  function initControls() {
    radiusSelect.addEventListener("change", () => {
      currentRadiusKm = parseFloat(radiusSelect.value);
      updateNearbyList();
      fitToNearbyPois();
    });

    prioritySelect.addEventListener("change", () => {
      currentPriority = prioritySelect.value || "nearest";
      updateNearbyList();
      fitToNearbyPois();
    });

    maxPointsSelect.addEventListener("change", () => {
      currentMaxPoints = parseInt(maxPointsSelect.value, 10) || 10;
      updateNearbyList();
      fitToNearbyPois();
    });

    locateBtn.addEventListener("click", () => {
      const uiLang = getUiLangId();
      const t = i18n[uiLang];
      if (!navigator.geolocation) {
        alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.");
        return;
      }
      locateBtn.disabled = true;
      locateBtn.textContent = t.locate.replace("üìç", "‚è≥");

      navigator.geolocation.getCurrentPosition(
        pos => {
          const { latitude, longitude } = pos.coords;
          userLocation = { lat: latitude, lon: longitude };
          updateUserMarker();
          map.flyTo({
            center: [longitude, latitude],
            zoom: 14,
            essential: true
          });
          locateBtn.disabled = false;
          locateBtn.textContent = t.locate;
        },
        err => {
          console.error(err);
          alert("Kh√¥ng l·∫•y ƒë∆∞·ª£c v·ªã tr√≠ c·ªßa b·∫°n.");
          locateBtn.disabled = false;
          locateBtn.textContent = t.locate;
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    });

    langToggleBtn.addEventListener("click", () => {
      langMenu.classList.toggle("open");
    });

    langMenu.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-lang-id]");
      if (!btn) return;
      const id = btn.getAttribute("data-lang-id");
      if (!id) return;
      const cfg = availableLanguages.find(l => l.id === id);
      if (!cfg || cfg === currentLangConfig) {
        langMenu.classList.remove("open");
        return;
      }
      currentLangConfig = cfg;
      langMenu.classList.remove("open");
      applyLanguage();
    });

    document.addEventListener("click", (e) => {
      if (!langMenu.contains(e.target) && !langToggleBtn.contains(e.target)) {
        langMenu.classList.remove("open");
      }
    });
  }

  (async function main() {
    await loadPois();
    initMap();
    initControls();
    renderLanguageMenu();
    applyLanguage();
  })();
</script>
</body>
</html>
