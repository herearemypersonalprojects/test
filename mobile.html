<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Paris Discovery ‚Äì Mobile</title>

  <!-- favicon -->
  <link rel="icon" type="image/svg+xml" href="/icons/castle_favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/castle_logo_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/castle_logo_32.png">
  <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://unpkg.com/maplibre-gl@3.5.2/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@3.5.2/dist/maplibre-gl.js"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

body {
  font-family:
    system-ui, -apple-system, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif;
  height: 100vh;              /* ‚úÖ ƒë√∫ng b·∫±ng chi·ªÅu cao viewport */
  /* b·ªè min-height: 100vh n·∫øu c√≤n */
  display: flex;
  flex-direction: column;
  background-color: #f3f7fb;
  color: #0d1b2a;
  font-size: 14px;
  overflow: hidden;           /* ‚úÖ kh√¥ng cho cu·ªôn to√†n trang,
                                 ch·ªâ cu·ªôn b√™n trong #poi-detail */
}


main {
  flex: 1;                    /* chi·∫øm h·∫øt ph·∫ßn c√≤n l·∫°i d∆∞·ªõi header */
  display: flex;
  flex-direction: column;
}

    /* Header */
    header {
      background: #0d47a1;
      color: #e3f2fd;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      box-shadow: 0 3px 7px rgba(0, 0, 0, 0.4);
      border-bottom: 2px solid #64b5f6;
      flex-shrink: 0;
    }

    header .left {
      display: flex;
      flex-direction: column;
      gap: 2px;
      max-width: 65%;
    }

    header .title {
      font-weight: 700;
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #bbdefb;
    }

    header .subtitle {
      font-size: 0.7rem;
      opacity: 0.95;
      color: #e3f2fd;
    }

    header .controls {
      display: flex;
      gap: 6px;
      align-items: center;
      flex: 1;
      justify-content: flex-end;
    }

    button {
      border: 1px solid #64b5f6;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 0.75rem;
      cursor: pointer;
      background: #1565c0;
      color: #e3f2fd;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25);
      transition: all 0.2s ease;
      font-weight: 500;
    }

    button:hover {
      background: #1e88e5;
    }

    button:disabled {
      opacity: 0.4;
      cursor: default;
      background: #0b3c75;
      border-color: #54759b;
    }

    .lang-switch {
      position: static;
    }

    .lang-toggle {
      border-radius: 50%;
      width: 32px;
      height: 32px;
      padding: 0;
      background: #1e88e5;
      border: 2px solid #bbdefb;
      cursor: pointer;
      font-size: 1.1rem;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lang-menu {
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 90vw;
      width: 240px;
      max-height: 60vh;
      overflow-y: auto;
      z-index: 9999;
      background: #0d47a1;
      border-radius: 6px;
      padding: 6px;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.8);
      border: 2px solid #64b5f6;
      display: none;
    }

    .lang-menu.open {
      display: block;
    }

    .lang-menu button {
      background: transparent;
      border-radius: 4px;
      border: none;
      padding: 7px 10px;
      color: #e3f2fd;
      font-size: 0.8rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      text-align: left;
      white-space: nowrap;
      box-shadow: none;
      transition: background 0.15s ease;
    }

    .lang-menu button:hover {
      background: #1565c0;
    }

.map-sidebar-wrapper {
  display: flex;
  flex-direction: column;
    flex: 1 1 auto;
  min-height: 0;
  height: calc(100vh - var(--header-height)); /* t·ªïng ph·∫ßn d∆∞·ªõi */
}


#map {
  height: calc(100dvh - var(--header-height) - var(--sidebar-height) );
}
.my-element {
  /* Fallback cho tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ dvh */
  height: calc(100vh - var(--header-height) - var(--sidebar-height) );
}

@supports (height: 100dvh) {
  .my-element {
    height: calc(100dvh - var(--header-height) - var(--sidebar-height) );
  }
}


    /* Khi c√≥ panel chi ti·∫øt: n·ª≠a tr√™n */
    body.has-detail .map-sidebar-wrapper {
      flex: 0 0 50vh;
      height: 50vh;
    }

    body.has-detail #map {
      flex: 1 1 auto;
      height: 100%;
    }

    .sidebar {
      max-width: 100%;
      min-width: 100%;
      display: flex;
      flex-direction: column;
      border-top: 2px solid #64b5f6;
      background-color: #f5f9ff;
      color: #0d1b2a;
      flex-shrink: 0;
    }

    /* C√≥ chi ti·∫øt: ·∫©n sidebar l·ªçc */
    body.has-detail .sidebar {
      display: none;
    }

    .sidebar-header {
      padding: 10px 12px;
      border-bottom: 1px solid #64b5f6;
      font-size: 0.85rem;
      background: #e3f2fd;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .sidebar-header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .sidebar-header-top span {
      font-weight: 700;
      color: #0d47a1;
      font-size: 0.9rem;
    }

    .filter-row {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 2px;
    }

    .radius-row,
    .priority-row,
    .count-row {
      display: flex;
      gap: 4px;
      align-items: center;
      flex: 1 1 0;
      font-size: 0.75rem;
      color: #1b3551;
      font-weight: 500;
      min-width: 0;
    }

    .radius-select,
    .priority-select,
    .count-select {
      font-size: 0.75rem;
      padding: 4px 6px;
      border-radius: 4px;
      border: 1px solid #64b5f6;
      background: #ffffff;
      color: #0d1b2a;
      flex: 1;
      min-width: 0;
    }
:root {
  --header-height: 60px;
  --sidebar-height: 200px;
}

    /* PANEL CHI TI·∫æT ·ªû N·ª¨A D∆Ø·ªöI */
#poi-detail {
  display: none;
  background: #ffffff;
  border-top: 2px solid #64b5f6;
  padding: 10px 12px;
  box-shadow: 0 -3px 8px rgba(0,0,0,0.15);
  flex-shrink: 0;

  /* chi·ªÅu cao kh√≠t 100% m√†n h√¨nh */
  height: calc(100vh - var(--header-h) - 50vh);
  overflow-y: auto;
}


    body.has-detail #poi-detail {
      display: block;
    }

    .poi-detail-img-wrapper {
      width: 100%;
      height: 25vh;
      overflow: hidden;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .poi-detail-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      display: block;
    }

    .poi-detail-title {
      font-weight: 700;
      font-size: 0.95rem;
      color: #0d47a1;
      margin-bottom: 4px;
    }

    .poi-detail-address {
      font-size: 0.8rem;
      color: #546e7a;
      margin-bottom: 6px;
    }

    .poi-detail-listen {
      margin-bottom: 8px;
      padding: 5px 10px;
      font-size: 0.8rem;
      border-radius: 4px;
      border: 1px solid #64b5f6;
      background: #1565c0;
      color: #e3f2fd;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .poi-detail-story {
      font-size: 0.8rem;
      color: #263238;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    .poi-detail-note {
      font-size: 0.7rem;
      color: #78909c;
      margin-top: 4px;
      font-style: italic;
    }

    .maplibregl-popup {
      display: none; /* mobile: kh√¥ng d√πng popup */
    }

    /* Markers */
    .poi-marker {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #1565c0;
      border: 3px solid #bbdefb;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
      font-size: 16px;
      color: #e3f2fd;
      transition: transform 0.2s ease, box-shadow 0.2s ease, z-index 0.2s ease;
      cursor: pointer;
    }

    .poi-marker::after {
      content: "‚öúÔ∏è";
      font-size: 14px;
      line-height: 1;
    }

    .poi-marker.highlighted {
      transform: scale(1.8);
      background: #42a5f5;
      border-color: #e3f2fd;
      box-shadow: 0 0 20px rgba(66, 165, 245, 0.9);
      z-index: 10;
    }

    .user-marker {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #1e8449;
      border: 3px solid #e3f2fd;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.7);
      font-size: 14px;
      z-index: 5;
    }

    .user-marker::after {
      content: "üë§";
      font-size: 12px;
    }
  </style>
</head>
<body>
<header>
  <div class="left">
    <div id="app-title" class="title">PARIS DISCOVERY</div>
    <div id="app-subtitle" class="subtitle">
      Move around to discover heritage sites near you.
    </div>
  </div>
  <div class="controls">
    <div class="lang-switch">
      <button id="lang-toggle" class="lang-toggle" aria-label="Change language">üá¨üáß</button>
      <div id="lang-menu" class="lang-menu"></div>
    </div>
    <button id="locate-btn">üìç My location</button>
  </div>
</header>

<main>
  <div class="map-sidebar-wrapper">
    <div id="map"></div>

    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-header-top">
          <span id="nearby-title">Nearby places</span>
        </div>

        <div class="filter-row">
          <div class="radius-row">
            <label id="radius-label" for="radius">Radius:</label>
            <select id="radius" class="radius-select">
              <option value="0.5" selected>500 m</option>
              <option value="1">1 km</option>
              <option value="2">2 km</option>
              <option value="5">5 km</option>
              <option value="10">10 km</option>
            </select>
          </div>

          <div class="priority-row">
            <label id="priority-label" for="priority-filter">Priority:</label>
            <select id="priority-filter" class="priority-select">
              <option value="topscore">Most famous</option>
              <option value="nearest">Nearest</option>
            </select>
          </div>

          <div class="count-row">
            <label id="count-label" for="max-points">Places:</label>
            <select id="max-points" class="count-select">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <section id="poi-detail"></section>
</main>

<script>
  let map;
  let pois = [];
  let markers = [];
  let currentRadiusKm = 0.5;
  let currentMaxPoints = 10;
  let currentPriority = "topscore";
  let isProgrammaticMove = false;

  const languageConfigs = [
    { id: "en", key: "story_en",         flag: "üá¨üáß", label: "English",       ttsLang: "en-US" },
    { id: "fr", key: "story",            flag: "üá´üá∑", label: "Fran√ßais",      ttsLang: "fr-FR" },
    { id: "vi", key: "story_vn",         flag: "üáªüá≥", label: "Ti·∫øng Vi·ªát",    ttsLang: "vi-VN" },
    { id: "pt", key: "story_portuguese", flag: "üáµüáπ", label: "Portugu√™s",     ttsLang: "pt-PT" },
    { id: "ar", key: "story_arabic",     flag: "üá∏üá¶", label: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",       ttsLang: "ar-SA" },
    { id: "hi", key: "story_hindi",      flag: "üáÆüá≥", label: "‡§π‡§ø‡§®‡•ç‡§¶‡•Ä",        ttsLang: "hi-IN" },
    { id: "bn", key: "story_bengali",    flag: "üáßüá©", label: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ",         ttsLang: "bn-BD" },
    { id: "ko", key: "story_korean",     flag: "üá∞üá∑", label: "ÌïúÍµ≠Ïñ¥",        ttsLang: "ko-KR" },
    { id: "tr", key: "story_turkish",    flag: "üáπüá∑", label: "T√ºrk√ße",       ttsLang: "tr-TR" },
    { id: "sv", key: "story_swedish",    flag: "üá∏üá™", label: "Svenska",      ttsLang: "sv-SE" },
    { id: "de", key: "story_german",     flag: "üá©üá™", label: "Deutsch",       ttsLang: "de-DE" },
    { id: "zh", key: "story_chinese",    flag: "üá®üá≥", label: "‰∏≠Êñá",          ttsLang: "zh-CN" },
    { id: "ja", key: "story_japanese",   flag: "üáØüáµ", label: "Êó•Êú¨Ë™û",        ttsLang: "ja-JP" },
    { id: "ru", key: "story_russian",    flag: "üá∑üá∫", label: "–†—É—Å—Å–∫–∏–π",      ttsLang: "ru-RU" },
    { id: "it", key: "story_italian",    flag: "üáÆüáπ", label: "Italiano",      ttsLang: "it-IT" },
  ];

  function detectInitialLang() {
    const params = new URLSearchParams(window.location.search);
    const langParam = (params.get("lang") || "").toLowerCase();
    if (!langParam) return languageConfigs[0];
    return languageConfigs.find(cfg => cfg.id === langParam) || languageConfigs[0];
  }
document.documentElement.style.setProperty("--header-h",
  document.querySelector("header").offsetHeight + "px"
);
document.documentElement.style.setProperty("--header-height",
  document.querySelector("header").offsetHeight + "px"
);

// 1. S√©lectionner l'√©l√©ment sidebar
const sidebarElement = document.querySelector('.sidebar');

if (sidebarElement) {
  // 2. Obtenir sa hauteur visible avec offsetHeight
  const sidebarHeight = sidebarElement.offsetHeight + "px";

document.documentElement.style.setProperty("--sidebar-height",
  sidebarHeight
);

  // Affiche le r√©sultat dans la console du navigateur
  console.log('Hauteur du sidebar :', sidebarHeight);
} else {
  console.log('√âl√©ment .sidebar non trouv√©.');
}

  let availableLanguages = languageConfigs.slice();
  let currentLangConfig = detectInitialLang();

  let voices = [];
  let currentUtterance = null;

  const PARIS_CENTER = { lat: 48.8566, lon: 2.3522 };
  const NOTRE_DAME   = { lat: 48.852968, lon: 2.349902 };

  let userLocation = null;
  let userMarker = null;

  let lastNearbyPois = [];
  let highlightedPoiIdx = null;
  let selectedPoiIdx = null;

  const locateBtn       = document.getElementById("locate-btn");
  const radiusSelect    = document.getElementById("radius");
  const nearbyTitleEl   = document.getElementById("nearby-title");
  const appTitleEl      = document.getElementById("app-title");
  const appSubtitleEl   = document.getElementById("app-subtitle");
  const radiusLabelEl   = document.getElementById("radius-label");
  const priorityLabelEl = document.getElementById("priority-label");
  const prioritySelect  = document.getElementById("priority-filter");
  const countLabelEl    = document.getElementById("count-label");
  const maxPointsSelect = document.getElementById("max-points");
  const langToggleBtn   = document.getElementById("lang-toggle");
  const langMenu        = document.getElementById("lang-menu");
  const poiDetailEl     = document.getElementById("poi-detail");

  const i18n = {
    vi: {
      appTitle:       'Kh√°m Ph√° Paris',
      appSubtitle:    'ƒêi ƒë·∫øn ƒë√¢u, kh√°m ph√° di s·∫£n xung quanh ƒë√≥',
      locate:         'üìç V·ªã tr√≠ c·ªßa t√¥i',
      nearbyDefault:  'ƒêi·ªÉm g·∫ßn b·∫°n',
      radiusLabel:    'B√°n k√≠nh:',
      empty: r => `Kh√¥ng c√≥ di s·∫£n n√†o trong b√°n k√≠nh ${r} km quanh v·ªã tr√≠ hi·ªán t·∫°i c·ªßa b·∫£n ƒë·ªì.`,
      emptyInitial:   'Di chuy·ªÉn b·∫£n ƒë·ªì ho·∫∑c b·∫•m "üìç V·ªã tr√≠ c·ªßa t√¥i" ƒë·ªÉ xem c√°c di s·∫£n g·∫ßn b·∫°n.',
      ttsLabel:       'üîä Nghe k·ªÉ chuy·ªán',
      ttsNotSupported:'Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªçc vƒÉn b·∫£n (Speech Synthesis).',
      ttsNoText:      'Kh√¥ng c√≥ n·ªôi dung ƒë·ªÉ ƒë·ªçc.',
      priorityLabel:  '∆Øu ti√™n:',
      priorityNearest:'G·∫ßn nh·∫•t',
      priorityTopScore:'N·ªïi ti·∫øng nh·∫•t',
      countLabel:     'S·ªë ƒëi·ªÉm:',
      detailHint:     '(Nh·∫•n v√†o ƒëo·∫°n m√¥ t·∫£ ƒë·ªÉ xem ƒë·∫ßy ƒë·ªß / thu g·ªçn)',
    },
    en: {
      appTitle:       'PARIS DISCOVERY',
      appSubtitle:    'Move around to discover heritage sites near you.',
      locate:         'üìç My location',
      nearbyDefault:  'Nearby places',
      radiusLabel:    'Radius:',
      empty: r => `No heritage site found within ${r} km of the current map center.`,
      emptyInitial:   'Move the map or click "üìç My location" to see nearby heritage sites.',
      ttsLabel:       'üîä Listen to story',
      ttsNotSupported:'Your browser does not support text-to-speech (Speech Synthesis).',
      ttsNoText:      'No story available to read.',
      priorityLabel:  'Priority:',
      priorityNearest:'Nearest',
      priorityTopScore:'Most famous',
      countLabel:     'Places:',
      detailHint:     'Tap the text to expand / collapse.',
    },
    fr: {
      appTitle:       'Explorez Paris',
      appSubtitle:    'Explorez les sites patrimoniaux proches.',
      locate:         'üìç Ma position',
      nearbyDefault:  'Lieux √† proximit√©',
      radiusLabel:    'Rayon :',
      empty: r => `Aucun site patrimonial dans un rayon de ${r} km autour du centre de la carte.`,
      emptyInitial:   'D√©placez la carte ou cliquez sur "üìç Ma position" pour voir les sites patrimoniaux √† proximit√©.',
      ttsLabel:       'üîä √âcouter l‚Äôhistoire',
      ttsNotSupported:'Votre navigateur ne supporte pas la synth√®se vocale (Speech Synthesis).',
      ttsNoText:      'Aucun texte √† lire pour ce lieu.',
      priorityLabel:  'Priorit√© :',
      priorityNearest:'Les plus proches',
      priorityTopScore:'Les plus c√©l√®bres',
      countLabel:     'Nombre :',
      detailHint:     'Touchez le texte pour afficher / r√©duire.',
    },
    pt: {
      appTitle:       'Descubra Paris',
      appSubtitle:    'Mova-se para descobrir os locais hist√≥ricos perto de voc√™.',
      locate:         'üìç Minha localiza√ß√£o',
      nearbyDefault:  'Locais pr√≥ximos',
      radiusLabel:    'Raio:',
      empty: r => `Nenhum local hist√≥rico encontrado num raio de ${r} km do centro do mapa.`,
      emptyInitial:   'Mova o mapa ou clique em "üìç Minha localiza√ß√£o" para ver os locais hist√≥ricos pr√≥ximos.',
      ttsLabel:       'üîä Ouvir a hist√≥ria',
      ttsNotSupported:'O seu navegador n√£o suporta s√≠ntese de voz (Speech Synthesis).',
      ttsNoText:      'N√£o h√° texto dispon√≠vel para este local.',
      priorityLabel:  'Prioridade:',
      priorityNearest:'Mais pr√≥ximos',
      priorityTopScore:'Mais famosos',
      countLabel:     'Quantidade:',
    },
    ar: {
      appTitle:       'ÿßŸÉÿ™ÿ¥ŸÅ ÿ®ÿßÿ±Ÿäÿ≥',
      appSubtitle:    'ÿ™ÿ≠ÿ±ŸëŸÉ ŸÑÿßŸÉÿ™ÿ¥ÿßŸÅ ÿßŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑÿ™ÿ±ÿßÿ´Ÿäÿ© ÿßŸÑŸÇÿ±Ÿäÿ®ÿ© ŸÖŸÜŸÉ.',
      locate:         'üìç ŸÖŸàŸÇÿπŸä',
      nearbyDefault:  'ÿ£ŸÖÿßŸÉŸÜ ŸÇÿ±Ÿäÿ®ÿ©',
      radiusLabel:    'ŸÜÿµŸÅ ÿßŸÑŸÇÿ∑ÿ±:',
      empty: r => `ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿßŸÇÿπ ÿ™ÿ±ÿßÿ´Ÿäÿ© ÿ∂ŸÖŸÜ ÿØÿßÿ¶ÿ±ÿ© ŸÜÿµŸÅ ŸÇÿ∑ÿ±Ÿáÿß ${r} ŸÉŸÖ ÿ≠ŸàŸÑ ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ≠ÿßŸÑŸä.`,
      emptyInitial:   'ÿ≠ÿ±ŸëŸÉ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿ£Ÿà ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "üìç ŸÖŸàŸÇÿπŸä" ŸÑÿ±ÿ§Ÿäÿ© ÿßŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑÿ™ÿ±ÿßÿ´Ÿäÿ© ÿßŸÑŸÇÿ±Ÿäÿ®ÿ©.',
      ttsLabel:       'üîä ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ÿ•ŸÑŸâ ÿßŸÑŸÇÿµÿ©',
      ttsNotSupported:'ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÑÿß ŸäÿØÿπŸÖ ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜÿµ ÿ•ŸÑŸâ ŸÉŸÑÿßŸÖ (Speech Synthesis).',
      ttsNoText:      'ŸÑÿß ŸäŸàÿ¨ÿØ ŸÜÿµ ŸÑŸÑŸÇÿ±ÿßÿ°ÿ© ŸÑŸáÿ∞ÿß ÿßŸÑŸÖŸàŸÇÿπ.',
      priorityLabel:  'ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©:',
      priorityNearest:'ÿßŸÑÿ£ŸÇÿ±ÿ®',
      priorityTopScore:'ÿßŸÑÿ£ÿ¥Ÿáÿ±',
      countLabel:     'ÿßŸÑÿπÿØÿØ:',
    },
    hi: {
      appTitle:       '‡§™‡•á‡§∞‡§ø‡§∏ ‡§ï‡•Ä ‡§ñ‡•ã‡§ú',
      appSubtitle:    '‡§Ö‡§™‡§®‡•á ‡§Ü‡§∏‡§™‡§æ‡§∏ ‡§ï‡•á ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§∏‡•ç‡§•‡§≤‡•ã‡§Ç ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ò‡•Ç‡§Æ‡•á‡§Ç‡•§',
      locate:         'üìç ‡§Æ‡•á‡§∞‡§æ ‡§∏‡•ç‡§•‡§æ‡§®',
      nearbyDefault:  '‡§™‡§æ‡§∏ ‡§ï‡•á ‡§∏‡•ç‡§•‡§æ‡§®',
      radiusLabel:    '‡§§‡•ç‡§∞‡§ø‡§ú‡•ç‡§Ø‡§æ:',
      empty: r => `‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞ ‡§ï‡•á ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§∏‡•á ${r} ‡§ï‡§ø‡§Æ‡•Ä ‡§ï‡•Ä ‡§§‡•ç‡§∞‡§ø‡§ú‡•ç‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§∏‡•ç‡§•‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§`,
      emptyInitial:   '‡§®‡§ï‡•ç‡§∂‡•á ‡§ï‡•ã ‡§ò‡•Å‡§Æ‡§æ‡§è‡§Å ‡§Ø‡§æ "üìç ‡§Æ‡•á‡§∞‡§æ ‡§∏‡•ç‡§•‡§æ‡§®" ‡§¶‡§¨‡§æ‡§è‡§Å ‡§§‡§æ‡§ï‡§ø ‡§™‡§æ‡§∏ ‡§ï‡•á ‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§∏‡•ç‡§•‡§≤ ‡§¶‡§ø‡§ñ‡•á‡§Ç‡•§',
      ttsLabel:       'üîä ‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡•Å‡§®‡•á‡§Ç',
      ttsNotSupported:'‡§Ü‡§™‡§ï‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü-‡§ü‡•Ç-‡§∏‡•ç‡§™‡•Ä‡§ö (Speech Synthesis) ‡§ï‡•ã ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§',
      ttsNoText:      '‡§á‡§∏ ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§™‡§æ‡§† ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§',
      priorityLabel:  '‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ:',
      priorityNearest:'‡§∏‡§¨‡§∏‡•á ‡§®‡§ú‡§º‡§¶‡•Ä‡§ï‡•Ä',
      priorityTopScore:'‡§∏‡§¨‡§∏‡•á ‡§™‡•ç‡§∞‡§∏‡§ø‡§¶‡•ç‡§ß',
      countLabel:     '‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ:',
    },
    bn: {
      appTitle:       '‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶∏ ‡¶ò‡ßÅ‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®',
      appSubtitle:    '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶∂‡¶™‡¶æ‡¶∂‡ßá‡¶∞ ‡¶ê‡¶§‡¶ø‡¶π‡ßç‡¶Ø‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡ßá‡¶§‡ßá ‡¶®‡¶°‡¶º‡¶æ‡¶ö‡¶°‡¶º‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
      locate:         'üìç ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®',
      nearbyDefault:  '‡¶ï‡¶æ‡¶õ‡¶æ‡¶ï‡¶æ‡¶õ‡¶ø ‡¶∏‡ßç‡¶•‡¶æ‡¶®',
      radiusLabel:    '‡¶¨‡ßç‡¶Ø‡¶æ‡¶∏‡¶æ‡¶∞‡ßç‡¶ß:',
      empty: r => `‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ${r} ‡¶ï‡¶ø‡¶Æ‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶∏‡¶æ‡¶∞‡ßç‡¶ß‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶ê‡¶§‡¶ø‡¶π‡ßç‡¶Ø‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§`,
      emptyInitial:   '‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞ ‡¶∏‡¶∞‡¶æ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ "üìç ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®" ‡¶ö‡¶æ‡¶™‡ßÅ‡¶® ‡¶ï‡¶æ‡¶õ‡¶æ‡¶ï‡¶æ‡¶õ‡¶ø ‡¶ê‡¶§‡¶ø‡¶π‡ßç‡¶Ø‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá‡•§',
      ttsLabel:       'üîä ‡¶ó‡¶≤‡ßç‡¶™ ‡¶∂‡ßÅ‡¶®‡ßÅ‡¶®',
      ttsNotSupported:'‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü-‡¶ü‡ßÅ-‡¶∏‡ßç‡¶™‡¶ø‡¶ö (Speech Synthesis) ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶® ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§',
      ttsNoText:      '‡¶è‡¶á ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶®‡ßá‡¶á‡•§',
      priorityLabel:  '‡¶Ö‡¶ó‡ßç‡¶∞‡¶æ‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞:',
      priorityNearest:'‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶®‡¶ø‡¶ï‡¶ü‡¶¨‡¶∞‡ßç‡¶§‡ßÄ',
      priorityTopScore:'‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡¶ø‡¶ñ‡ßç‡¶Ø‡¶æ‡¶§',
      countLabel:     '‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ:',
    },
    ko: {
      appTitle:       'ÌååÎ¶¨Î•º Î∞úÍ≤¨ÌïòÏÑ∏Ïöî',
      appSubtitle:    'Ï£ºÎ≥ÄÏùò Ïú†ÏÇ∞ Ïû•ÏÜåÎ•º Î∞úÍ≤¨ÌïòÍ∏∞ ÏúÑÌï¥ Ïù¥ÎèôÌï¥ Î≥¥ÏÑ∏Ïöî.',
      locate:         'üìç ÎÇ¥ ÏúÑÏπò',
      nearbyDefault:  'Ï£ºÎ≥Ä Ïû•ÏÜå',
      radiusLabel:    'Î∞òÍ≤Ω:',
      empty: r => `ÌòÑÏû¨ ÏßÄÎèÑ Ï§ëÏã¨ÏóêÏÑú Î∞òÍ≤Ω ${r}km ÏïàÏóê Ïú†ÏÇ∞ Ïû•ÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§.`,
      emptyInitial:   'ÏßÄÎèÑÎ•º ÏõÄÏßÅÏù¥Í±∞ÎÇò "üìç ÎÇ¥ ÏúÑÏπò"Î•º ÎàåÎü¨ Ï£ºÎ≥Ä Ïú†ÏÇ∞ Ïû•ÏÜåÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.',
      ttsLabel:       'üîä Ïù¥ÏïºÍ∏∞ Îì£Í∏∞',
      ttsNotSupported:'Î∏åÎùºÏö∞Ï†ÄÍ∞Ä ÌÖçÏä§Ìä∏ ÏùåÏÑ± Î≥ÄÌôò(Speech Synthesis)ÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.',
      ttsNoText:      'Ïù¥ Ïû•ÏÜåÏóê ÎåÄÌï¥ ÏùΩÏùÑ Ïàò ÏûàÎäî ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.',
      priorityLabel:  'Ïö∞ÏÑ†ÏàúÏúÑ:',
      priorityNearest:'Í∞ÄÏû• Í∞ÄÍπåÏö¥',
      priorityTopScore:'Í∞ÄÏû• Ïú†Î™ÖÌïú',
      countLabel:     'Í∞úÏàò:',
    },
    tr: {
      appTitle:       'Paris‚Äôi ke≈üfet',
      appSubtitle:    'Yakƒ±nƒ±nƒ±zdaki k√ºlt√ºrel miras alanlarƒ±nƒ± ke≈üfetmek i√ßin hareket edin.',
      locate:         'üìç Konumum',
      nearbyDefault:  'Yakƒ±n yerler',
      radiusLabel:    'Yarƒ±√ßap:',
      empty: r => `Haritanƒ±n mevcut merkezi etrafƒ±nda ${r} km yarƒ±√ßap i√ßinde herhangi bir miras alanƒ± bulunamadƒ±.`,
      emptyInitial:   'Haritayƒ± hareket ettirin veya "üìç Konumum" d√ºƒümesine tƒ±klayƒ±n ve yakƒ±n miras alanlarƒ±nƒ± g√∂r√ºn.',
      ttsLabel:       'üîä Hik√¢yeyi dinle',
      ttsNotSupported:'Tarayƒ±cƒ±nƒ±z metin okuma (Speech Synthesis) √∂zelliƒüini desteklemiyor.',
      ttsNoText:      'Bu yer i√ßin okunacak bir metin yok.',
      priorityLabel:  '√ñncelik:',
      priorityNearest:'En yakƒ±n',
      priorityTopScore:'En √ºnl√º',
      countLabel:     'Sayƒ±:',
    },
    sv: {
      appTitle:       'Uppt√§ck Paris',
      appSubtitle:    'R√∂r dig f√∂r att uppt√§cka kulturarvsplatser n√§ra dig.',
      locate:         'üìç Min position',
      nearbyDefault:  'Platser i n√§rheten',
      radiusLabel:    'Radie:',
      empty: r => `Inga kulturarvsplatser hittades inom ${r} km fr√•n kartans nuvarande centrum.`,
      emptyInitial:   'Flytta kartan eller klicka p√• "üìç Min position" f√∂r att se kulturarvsplatser i n√§rheten.',
      ttsLabel:       'üîä Lyssna p√• ber√§ttelsen',
      ttsNotSupported:'Din webbl√§sare st√∂der inte text-till-tal (Speech Synthesis).',
      ttsNoText:      'Det finns ingen text att l√§sa upp f√∂r den h√§r platsen.',
      priorityLabel:  'Prioritet:',
      priorityNearest:'N√§rmast',
      priorityTopScore:'Mest k√§nda',
      countLabel:     'Antal:',
    },
    de: {
      appTitle:       'Paris entdecken',
      appSubtitle:    'Bewegen Sie sich, um Sehensw√ºrdigkeiten in Ihrer N√§he zu entdecken.',
      locate:         'üìç Mein Standort',
      nearbyDefault:  'Orte in der N√§he',
      radiusLabel:    'Radius:',
      empty: r => `Keine Sehensw√ºrdigkeit im Umkreis von ${r} km um die aktuelle Kartenmitte gefunden.`,
      emptyInitial:   'Verschieben Sie die Karte oder klicken Sie auf "üìç Mein Standort", um nahegelegene Sehensw√ºrdigkeiten zu sehen.',
      ttsLabel:       'üîä Geschichte anh√∂ren',
      ttsNotSupported:'Ihr Browser unterst√ºtzt keine Sprachausgabe (Speech Synthesis).',
      ttsNoText:      'F√ºr diesen Ort gibt es keinen Text zum Vorlesen.',
      priorityLabel:  'Priorit√§t:',
      priorityNearest:'N√§chstgelegen',
      priorityTopScore:'Am bekanntesten',
      countLabel:     'Anzahl:',
    },
    zh: {
      appTitle:       'Êé¢Á¥¢Â∑¥Èªé',
      appSubtitle:    'ÁßªÂä®Âú∞ÂõæÔºåÂèëÁé∞ÊÇ®ÈôÑËøëÁöÑÊñáÂåñÈÅó‰∫ßÊôØÁÇπ„ÄÇ',
      locate:         'üìç ÊàëÁöÑ‰ΩçÁΩÆ',
      nearbyDefault:  'ÈôÑËøëÂú∞ÁÇπ',
      radiusLabel:    'ÂçäÂæÑÔºö',
      empty: r => `Âú®ÂΩìÂâçÂú∞Âõæ‰∏≠ÂøÉ${r}ÂÖ¨ÈáåËåÉÂõ¥ÂÜÖÊú™ÊâæÂà∞‰ªª‰ΩïÊñáÂåñÈÅó‰∫ßÂú∞ÁÇπ„ÄÇ`,
      emptyInitial:   'ÁßªÂä®Âú∞ÂõæÊàñÁÇπÂáª‚Äúüìç ÊàëÁöÑ‰ΩçÁΩÆ‚ÄùÊù•Êü•ÁúãÈôÑËøëÁöÑÊñáÂåñÈÅó‰∫ßÂú∞ÁÇπ„ÄÇ',
      ttsLabel:       'üîä Âê¨ÊïÖ‰∫ã',
      ttsNotSupported:'ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅÊñáÊú¨ÊúóËØªÔºàSpeech SynthesisÔºâ„ÄÇ',
      ttsNoText:      'Ê≠§Âú∞ÁÇπÊ≤°ÊúâÂèØÊúóËØªÁöÑÂÜÖÂÆπ„ÄÇ',
      priorityLabel:  '‰ºòÂÖàÁ∫ßÔºö',
      priorityNearest:'ÊúÄËøë',
      priorityTopScore:'ÊúÄËëóÂêç',
      countLabel:     'Êï∞ÈáèÔºö',
    },
    ja: {
      appTitle:       '„Éë„É™„ÇíÁô∫Ë¶ã',
      appSubtitle:    'Âë®Ëæ∫„ÅÆÊñáÂåñÈÅ∫Áî£„ÇíË¶ã„Å§„Åë„Çã„Åü„ÇÅ„Å´ÁßªÂãï„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ',
      locate:         'üìç ÁèæÂú®Âú∞',
      nearbyDefault:  'Ëøë„Åè„ÅÆÂ†¥ÊâÄ',
      radiusLabel:    'ÂçäÂæÑ:',
      empty: r => `ÁèæÂú®„ÅÆÂú∞Âõ≥‰∏≠ÂøÉ„Åã„ÇâÂçäÂæÑ${r}km‰ª•ÂÜÖ„Å´ÊñáÂåñÈÅ∫Áî£„ÅØË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ`,
      emptyInitial:   'Âú∞Âõ≥„ÇíÂãï„Åã„Åô„Åã„Äåüìç ÁèæÂú®Âú∞„Äç„Çí„Çø„ÉÉ„Éó„Åó„Å¶„ÄÅËøë„Åè„ÅÆÊñáÂåñÈÅ∫Áî£„ÇíË°®Á§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
      ttsLabel:       'üîä „Çπ„Éà„Éº„É™„Éº„ÇíËÅû„Åè',
      ttsNotSupported:'„ÅîÂà©Áî®„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ„ÉÜ„Ç≠„Çπ„ÉàË™≠„Åø‰∏ä„ÅíÔºàSpeech SynthesisÔºâ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ',
      ttsNoText:      '„Åì„ÅÆÂ†¥ÊâÄ„Å´„ÅØË™≠„Åø‰∏ä„Åí„Çã„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ',
      priorityLabel:  'ÂÑ™ÂÖàÈ†Ü‰Ωç:',
      priorityNearest:'ÊúÄ„ÇÇËøë„ÅÑ',
      priorityTopScore:'ÊúÄ„ÇÇÊúâÂêç',
      countLabel:     '‰ª∂Êï∞:',
    },
    ru: {
      appTitle:       '–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –ü–∞—Ä–∏–∂',
      appSubtitle:    '–ü–µ—Ä–µ–¥–≤–∏–≥–∞–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –Ω–∞—Ö–æ–¥–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è —Ä—è–¥–æ–º —Å –≤–∞–º–∏.',
      locate:         'üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',
      nearbyDefault:  '–ú–µ—Å—Ç–∞ —Ä—è–¥–æ–º',
      radiusLabel:    '–†–∞–¥–∏—É—Å:',
      empty: r => `–í —Ä–∞–¥–∏—É—Å–µ ${r} –∫–º –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞ –∫–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤ –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è.`,
      emptyInitial:   '–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –∫–∞—Ä—Ç—É –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ", —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –±–ª–∏–∂–∞–π—à–∏–µ –æ–±—ä–µ–∫—Ç—ã –Ω–∞—Å–ª–µ–¥–∏—è.',
      ttsLabel:       'üîä –ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é',
      ttsNotSupported:'–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ (Speech Synthesis).',
      ttsNoText:      '–î–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è.',
      priorityLabel:  '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:',
      priorityNearest:'–ë–ª–∏–∂–∞–π—à–∏–µ',
      priorityTopScore:'–°–∞–º—ã–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ',
      countLabel:     '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:',
    },
    it: {
      appTitle:       'Scopri Parigi',
      appSubtitle:    'Muoviti per scoprire i siti storici vicino a te.',
      locate:         'üìç La mia posizione',
      nearbyDefault:  'Luoghi vicini',
      radiusLabel:    'Raggio:',
      empty: r => `Nessun sito storico trovato entro ${r} km dal centro attuale della mappa.`,
      emptyInitial:   'Sposta la mappa o fai clic su "üìç La mia posizione" per vedere i siti storici nelle vicinanze.',
      ttsLabel:       'üîä Ascolta la storia',
      ttsNotSupported:'Il tuo browser non supporta la sintesi vocale (Speech Synthesis).',
      ttsNoText:      'Nessun testo da leggere per questo luogo.',
      priorityLabel:  'Priorit√†:',
      priorityNearest:'Pi√π vicini',
      priorityTopScore:'Pi√π famosi',
      countLabel:     'Numero:',
    },
  };

  function getUiLangId() {
    if (!currentLangConfig) return 'en';
    const id = currentLangConfig.id;
    return i18n[id] ? id : 'en';
  }

  function getName(poi) {
    const lang = getUiLangId();
    if (lang === "vi") {
      return poi.name_vn || poi.name_en || poi.name || "Kh√¥ng t√™n";
    } else if (lang === "en") {
      return poi.name_en || poi.name || poi.name_vn || "Unnamed";
    } else {
      return poi.name || poi.name_en || poi.name_vn || "Sans nom";
    }
  }

  function getAddress(poi) {
    const lang = getUiLangId();
    if (lang === "vi") {
      return poi.address_vn || poi.address_en || poi.address || "";
    } else if (lang === "en") {
      return poi.address_en || poi.address || poi.address_vn || "";
    } else {
      return poi.address || poi.address_en || poi.address_vn || "";
    }
  }

  function getStory(poi) {
    if (currentLangConfig && poi[currentLangConfig.key]) {
      return poi[currentLangConfig.key];
    }
    if (poi.story_en) return poi.story_en;
    if (poi.story)    return poi.story;
    if (poi.story_vn) return poi.story_vn;
    return "";
  }

  function loadVoices() {
    voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
  }
  if ("speechSynthesis" in window) {
    window.speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();
  }

  function getVoiceForLangCode(langCode) {
    if (!voices || !voices.length) return null;
    const prefix = langCode.split("-")[0].toLowerCase();
    let v = voices.find(v => v.lang && v.lang.toLowerCase().startsWith(prefix));
    if (!v) v = voices[0];
    return v;
  }

  function playPoiStory(index) {
    const uiLang = getUiLangId();
    const t = i18n[uiLang];

    if (!("speechSynthesis" in window)) {
      alert(t.ttsNotSupported);
      return;
    }

    if (window.speechSynthesis.speaking || window.speechSynthesis.pending) {
      window.speechSynthesis.cancel();
      currentUtterance = null;
      return;
    }

    const poi = pois[index];
    if (!poi) return;
    const text = getStory(poi);
    if (!text) {
      alert(t.ttsNoText);
      return;
    }

    const langCode = currentLangConfig?.ttsLang || "en-US";
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = langCode;
    const v = getVoiceForLangCode(langCode);
    if (v) utter.voice = v;

    currentUtterance = utter;
    window.speechSynthesis.speak(utter);
  }

  window.playPoiStory = playPoiStory;

  function distanceKm(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a =
      Math.sin(dLat / 2) * Math.sin(dLat / 2) +
      Math.cos(lat1 * Math.PI / 180) *
      Math.cos(lat2 * Math.PI / 180) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  function highlightMarkerForPoiIdx(idx) {
    highlightedPoiIdx = idx;
    markers.forEach(m => {
      if (!m._el) return;
      if (m._poiIdx === idx) {
        m._el.classList.add("highlighted");
      } else {
        m._el.classList.remove("highlighted");
      }
    });
  }

  function createMarker(poi) {
    const el = document.createElement("div");
    el.className = "poi-marker";

    const marker = new maplibregl.Marker({ element: el, anchor: 'center' })
      .setLngLat([poi.lon, poi.lat])
      .addTo(map);

    marker._el = el;
    marker._poiIdx = poi._idx;

    el.addEventListener("click", (e) => {
      e.stopPropagation();
      showPoiDetail(poi._idx);
    });

    return marker;
  }

  function clearMarkers() {
    markers.forEach(m => m.remove());
    markers = [];
  }

  function updateUserMarker() {
    if (!map || !userLocation) return;
    if (userMarker) {
      userMarker.setLngLat([userLocation.lon, userLocation.lat]);
    } else {
      const el = document.createElement("div");
      el.className = "user-marker";
      userMarker = new maplibregl.Marker({ element: el, anchor: 'center' })
        .setLngLat([userLocation.lon, userLocation.lat])
        .addTo(map);
    }
  }

  function updateNearbyList() {
    if (!map || !pois.length) return;
    const center = map.getCenter();
    const centerLat = center.lat;
    const centerLon = center.lng;
    const uiLang = getUiLangId();
    const t = i18n[uiLang];

    const valid = pois.filter(p => p.lat && p.lon);

    let within = valid
      .map(p => ({
        ...p,
        dist: distanceKm(centerLat, centerLon, p.lat, p.lon),
      }))
      .filter(p => p.dist <= currentRadiusKm);

    let selected = [];

    if (within.length === 0) {
      selected = [];
    } else if (currentPriority === "nearest") {
      selected = within
        .sort((a, b) => a.dist - b.dist)
        .slice(0, currentMaxPoints);
    } else {
      selected = within
        .sort((a, b) => {
          const sa = typeof a.score === "number" ? a.score : -Infinity;
          const sb = typeof b.score === "number" ? b.score : -Infinity;
          return sb - sa;
        });
      if (selected.length > currentMaxPoints) {
        selected = selected.slice(0, currentMaxPoints);
      }
    }

    lastNearbyPois = selected;

    clearMarkers();
    selected.forEach(p => {
      const m = createMarker(p);
      markers.push(m);
    });

    highlightMarkerForPoiIdx(highlightedPoiIdx);
    updateUserMarker();

    if (!selected.length) {
      nearbyTitleEl.textContent = t.empty(currentRadiusKm);
      return;
    }

    nearbyTitleEl.textContent = t.nearbyDefault;
  }

  function fitToNearbyPois() {
    if (!map || !lastNearbyPois || !lastNearbyPois.length) return;

    if (lastNearbyPois.length === 1) {
      const p = lastNearbyPois[0];
      map.easeTo({
        center: [p.lon, p.lat],
        zoom: 16,
        essential: true
      });
      return;
    }

    const bounds = new maplibregl.LngLatBounds();
    lastNearbyPois.forEach(p => bounds.extend([p.lon, p.lat]));
    if (userLocation) bounds.extend([userLocation.lon, userLocation.lat]);

    map.fitBounds(bounds, { padding: 40 });
  }

  function initMap() {
    const osmStyle = {
      version: 8,
      sources: {
        "osm-tiles": {
          type: "raster",
          tiles: ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
          tileSize: 256,
          attribution: ""
        }
      },
      layers: [
        {
          id: "osm-tiles",
          type: "raster",
          source: "osm-tiles",
          minzoom: 0,
          maxzoom: 19
        }
      ]
    };

    map = new maplibregl.Map({
      container: "map",
      style: osmStyle,
      center: [PARIS_CENTER.lon, PARIS_CENTER.lat],
      zoom: 12
    });

    map.on("load", () => {
      resetView();
    });

    map.on("moveend", () => {
      if (isProgrammaticMove) {
        isProgrammaticMove = false;
        updateNearbyList();
        return;
      }
      updateNearbyList();
      if (document.body.classList.contains('has-detail')) {
        hidePoiDetail();
      }
    });

    map.on("click", (e) => {
      if (!e.originalEvent.target.closest('.maplibregl-marker')) {
        highlightMarkerForPoiIdx(null);
        selectedPoiIdx = null;
        hidePoiDetail();
      }
    });
  }

  async function loadPois() {
    try {
      const res = await fetch("paris_story_multilanguage.json");
      if (!res.ok) {
        throw new Error("Kh√¥ng load ƒë∆∞·ª£c paris_story_multilanguage.json: " + res.status);
      }
      const raw = await res.json();
      pois = raw.map((p, idx) => ({ ...p, _idx: idx }));
    } catch (err) {
      console.error(err);
      alert("Kh√¥ng load ƒë∆∞·ª£c d·ªØ li·ªáu POI (paris_story_multilanguage.json). H√£y ki·ªÉm tra l·∫°i file v√† ƒë∆∞·ªùng d·∫´n.");
    }
  }

  function renderLanguageMenu() {
    if (!availableLanguages.length) return;
    langMenu.innerHTML = "";

    availableLanguages.forEach(cfg => {
      const btn = document.createElement("button");
      btn.setAttribute("data-lang-id", cfg.id);
      btn.innerHTML = `<span>${cfg.flag}</span><span>${cfg.label}</span>`;
      langMenu.appendChild(btn);
    });

    langToggleBtn.textContent = currentLangConfig.flag || "üåê";
  }

  function applyLanguage() {
    const uiLang = getUiLangId();
    const t = i18n[uiLang];

    appTitleEl.textContent    = t.appTitle;
    appSubtitleEl.textContent = t.appSubtitle;
    locateBtn.textContent     = t.locate;
    radiusLabelEl.textContent = t.radiusLabel;
    priorityLabelEl.textContent = t.priorityLabel;
    countLabelEl.textContent  = t.countLabel;
    nearbyTitleEl.textContent = t.nearbyDefault;

    const nearestOpt = prioritySelect.querySelector('option[value="nearest"]');
    const topOpt = prioritySelect.querySelector('option[value="topscore"]');
    if (nearestOpt) nearestOpt.textContent = t.priorityNearest;
    if (topOpt) topOpt.textContent = t.priorityTopScore;

    langToggleBtn.textContent = currentLangConfig.flag || "üåê";

    updateNearbyList();

    // n·∫øu ƒëang m·ªü detail th√¨ render l·∫°i n·ªôi dung theo ng√¥n ng·ªØ m·ªõi nh∆∞ng kh√¥ng di chuy·ªÉn map
    if (selectedPoiIdx !== null) {
      showPoiDetail(selectedPoiIdx, { skipMove: true });
    }
  }

  function resetView() {
    let center = [NOTRE_DAME.lon, NOTRE_DAME.lat];

    if (userLocation) {
      const d = distanceKm(
        userLocation.lat,
        userLocation.lon,
        PARIS_CENTER.lat,
        PARIS_CENTER.lon
      );
      if (d <= 8) {
        center = [userLocation.lon, userLocation.lat];
      }
    }

    map.jumpTo({
      center,
      zoom: 14
    });

    highlightMarkerForPoiIdx(null);
    selectedPoiIdx = null;
    hidePoiDetail();

    updateNearbyList();
    fitToNearbyPois();
  }

  function initControls() {
    radiusSelect.addEventListener("change", () => {
      currentRadiusKm = parseFloat(radiusSelect.value);
      updateNearbyList();
      fitToNearbyPois();
    });

    prioritySelect.addEventListener("change", () => {
      currentPriority = prioritySelect.value || "nearest";
      updateNearbyList();
      fitToNearbyPois();
    });

    maxPointsSelect.addEventListener("change", () => {
      currentMaxPoints = parseInt(maxPointsSelect.value, 10) || 10;
      updateNearbyList();
      fitToNearbyPois();
    });

    locateBtn.addEventListener("click", () => {
      const uiLang = getUiLangId();
      const t = i18n[uiLang];
      if (!navigator.geolocation) {
        alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.");
        return;
      }
      locateBtn.disabled = true;
      locateBtn.textContent = t.locate.replace("üìç", "‚è≥");

      navigator.geolocation.getCurrentPosition(
        pos => {
          const { latitude, longitude } = pos.coords;
          userLocation = { lat: latitude, lon: longitude };
          updateUserMarker();
          hidePoiDetail();
          isProgrammaticMove = true;
          map.flyTo({
            center: [longitude, latitude],
            zoom: 14,
            essential: true
          });
          locateBtn.disabled = false;
          locateBtn.textContent = t.locate;
        },
        err => {
          console.error(err);
          alert("Kh√¥ng l·∫•y ƒë∆∞·ª£c v·ªã tr√≠ c·ªßa b·∫°n.");
          locateBtn.disabled = false;
          locateBtn.textContent = t.locate;
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    });

    langToggleBtn.addEventListener("click", () => {
      langMenu.classList.toggle("open");
    });

    langMenu.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-lang-id]");
      if (!btn) return;
      const id = btn.getAttribute("data-lang-id");
      if (!id) return;
      const cfg = availableLanguages.find(l => l.id === id);
      if (!cfg || cfg === currentLangConfig) {
        langMenu.classList.remove("open");
        return;
      }
      currentLangConfig = cfg;
      langMenu.classList.remove("open");
      applyLanguage();
    });

    document.addEventListener("click", (e) => {
      if (!langMenu.contains(e.target) && !langToggleBtn.contains(e.target)) {
        langMenu.classList.remove("open");
      }
    });
  }

  function showPoiDetail(idx, options = {}) {
    const poi = pois[idx];
    if (!poi) return;
    const skipMove = options.skipMove;

    selectedPoiIdx = idx;
    highlightMarkerForPoiIdx(idx);

    const uiLang = getUiLangId();
    const t = i18n[uiLang];

    const title     = getName(poi);
    const addr      = getAddress(poi);
    const storyFull = getStory(poi) || "";


    const imgSrc = poi.reference
      ? `./images/${poi.reference.toLowerCase()}.jpg`
      : "";

    poiDetailEl.innerHTML = `
      <div class="poi-detail-img-wrapper">
        <img
          src="${imgSrc}"
          class="poi-detail-img"
          alt="${title}"
          onerror="this.style.display='none';"
        />
      </div>
      <div class="poi-detail-title">${title}</div>
      <div class="poi-detail-address">${addr}</div>
      <button type="button"
        class="poi-detail-listen"
        onclick="playPoiStory(${idx})">
        ${t.ttsLabel}
      </button>
    <div class="poi-detail-story" id="poi-detail-story"></div>
  `;
// 2Ô∏è‚É£ G√°n text cho story b·∫±ng textContent ‚Üí lu√¥n hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß, an to√†n
  const storyEl = document.getElementById("poi-detail-story");
  if (storyEl) {
    storyEl.textContent = storyFull;
  }
    document.body.classList.add('has-detail');

    if (map && poi.lat && poi.lon && !skipMove) {
      isProgrammaticMove = true;
      map.easeTo({
        center: [poi.lon, poi.lat],
        zoom: map.getZoom(),
        essential: true
      });
    }
  }

  function hidePoiDetail() {
    poiDetailEl.innerHTML = "";
    document.body.classList.remove('has-detail');
    selectedPoiIdx = null;
    highlightMarkerForPoiIdx(null);
  }

  (async function main() {
    await loadPois();
    initMap();
    initControls();
    renderLanguageMenu();
    applyLanguage();
  })();
</script>
</body>
</html>
